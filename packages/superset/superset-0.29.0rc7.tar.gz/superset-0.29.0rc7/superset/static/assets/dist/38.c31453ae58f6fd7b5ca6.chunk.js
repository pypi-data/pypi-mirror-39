(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{1560:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLayer=h;var n=s(r(1)),o=s(r(0)),i=r(2532),u=s(r(2531)),a=r(2528),l=s(r(2526)),c=r(2525);function s(e){return e&&e.__esModule?e:{default:e}}var f={fillColor:"fillColor",color:"fillColor",fill:"fillColor","fill-color":"fillColor",strokeColor:"strokeColor","stroke-color":"strokeColor","stroke-width":"strokeWidth"},p=function(){return function(e,t){var r={};return Object.keys(e).forEach(function(t){t in f?r[f[t]]=e[t]:r[t]=e[t]}),"string"==typeof e.fillColor&&(r.fillColor=(0,a.hexToRGB)(e.fillColor)),"string"==typeof e.strokeColor&&(r.strokeColor=(0,a.hexToRGB)(e.strokeColor)),Object.assign({},r,t)}}(),d=void 0,v=function(){return function e(t,r,n){if(t&&t.features&&t.features.forEach(function(o){e(o,r,t.extraProps||n)}),t&&t.geometry){var o=Object.assign({},t,{properties:p(t.properties,r)});o.extraProps||(o.extraProps=n),d.push(o)}}}();function h(e,t,r,n){var o=e,u=o.fill_color_picker,a=o.stroke_color_picker,s=[u.r,u.g,u.b,255*u.a],f=[a.r,a.g,a.b,255*a.a],p={};s[3]>0&&(p.fillColor=s),f[3]>0&&(p.strokeColor=f),d=[],v(t.data,p);var h=void 0;return o.js_data_mutator&&(h=(0,l.default)(o.js_data_mutator),d=h(d)),new i.GeoJsonLayer(Object.assign({id:"geojson-layer-"+o.slice_id,filled:o.filled,data:d,stroked:o.stroked,extruded:o.extruded,pointRadiusScale:o.point_radius_scale},(0,c.commonLayerProps)(o,n)))}var y={formData:o.default.object.isRequired,payload:o.default.object.isRequired,setControlValue:o.default.func.isRequired,viewport:o.default.object.isRequired,onAddFilter:o.default.func,setTooltip:o.default.func},b={onAddFilter:function(){return function(){}}(),setTooltip:function(){return function(){}}()};function _(e){var t=e.formData,r=e.payload,o=e.setControlValue,i=(e.onAddFilter,e.setTooltip),a=e.viewport,l=h(t,r,0,i);return n.default.createElement(u.default,{mapboxApiAccessToken:r.data.mapboxApiKey,viewport:a,layers:[l],mapStyle:t.mapbox_style,setControlValue:o})}_.propTypes=y,_.defaultProps=b,t.default=_},2525:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBounds=l,t.fitViewport=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;try{var n=l(t);return Object.assign({},e,(0,o.fitBounds)({height:e.height,width:e.width,padding:r,bounds:n}))}catch(t){return console.error("Could not auto zoom",t),e}},t.commonLayerProps=function(e,t,r){var o=e,i=void 0,a=void 0;if(o.js_tooltip)a=(0,u.default)(o.js_tooltip);else if(o.line_column&&o.metric&&["geohash","zipcode"].indexOf(o.line_type)>=0){var l=o.metric.label||o.metric;a=function(){return function(e){return n.default.createElement("div",null,n.default.createElement("div",null,o.line_column,": ",n.default.createElement("strong",null,e.object[o.line_column])),o.metric&&n.default.createElement("div",null,l,": ",n.default.createElement("strong",null,e.object[l])))}}()}a&&(i=function(){return function(e){e.picked?t({content:a(e),x:e.x,y:e.y}):t(null)}}());var c=void 0;o.js_onclick_href?c=function(){return function(e){var t=(0,u.default)(o.js_onclick_href)(e);window.open(t)}}():o.table_filter&&void 0!==r&&(c=function(){return function(e){return r(e.object[o.line_column])}}());return{onClick:c,onHover:i,pickable:Boolean(i)}},t.getAggFunc=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sum",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("count"===e)return function(e){return e.length};var r=void 0;r=e in c?function(){return function(r,n){var o=void 0;o=t?r.sort(function(e,r){return i.ascending(t(e),t(r))}):r.sort(i.ascending);return i.quantile(o,c[e],n)}}():i[e];if(!t)return function(e){return r(e)};return function(e){return r(e.map(t))}};var n=a(r(1)),o=r(2535),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(17)),u=a(r(2526));function a(e){return e&&e.__esModule?e:{default:e}}function l(e){var t=i.extent(e,function(e){return e[1]}),r=i.extent(e,function(e){return e[0]});return[[r[0],t[0]],[r[1],t[1]]]}var c={p1:.01,p5:.05,p95:.95,p99:.99}},2526:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){var o={},i="SAFE_EVAL_"+Math.floor(1e6*Math.random());o[i]={};var u=i+"="+e,a=Object.assign({},c,t);Object.keys(a).forEach(function(e){o[e]=a[e]});try{return n.default.runInNewContext(u,o,r),o[i]}catch(e){return function(){return e}}};var n=l(r(2553)),o=l(r(2554)),i=a(r(17)),u=a(r(2528));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function l(e){return e&&e.__esModule?e:{default:e}}var c={console:console,_:o.default,colors:u,d3array:i}},2528:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hexToRGB=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;if(!e)return[0,0,0,t];var r=(0,n.rgb)(e),o=r.r,i=r.g,u=r.b;return[o,i,u,t]};var n=r(42)},2531:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(477)),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=s(r(1)),a=s(r(0)),l=s(r(2547)),c=s(r(2532));function s(e){return e&&e.__esModule?e:{default:e}}r(2555);var f=2e3,p={viewport:a.default.object.isRequired,layers:a.default.array.isRequired,setControlValue:a.default.func,mapStyle:a.default.string,mapboxApiAccessToken:a.default.string.isRequired,onViewportChange:a.default.func},d={mapStyle:"light",onViewportChange:function(){return function(){}}(),setControlValue:function(){return function(){}}()},v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.tick=r.tick.bind(r),r.onViewportChange=r.onViewportChange.bind(r),r.state={previousViewport:e.viewport,timer:setInterval(r.tick,f)},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u["default"].Component),i(t,[{key:"componentWillUnmount",value:function(){return function(){clearInterval(this.state.timer)}}()},{key:"onViewportChange",value:function(){return function(e){var t=Object.assign({},e),r=Object.assign({},this.state.previousViewport,t);this.props.onViewportChange(r)}}()},{key:"tick",value:function(){return function(){var e=this;if(this.state&&!(0,n.default)(this.state.previousViewport,this.props.viewport)){var t=this.props.setControlValue,r=this.props.viewport;t&&t("viewport",r),this.setState(function(){return{previousViewport:e.props.viewport}})}}}()},{key:"layers",value:function(){return function(){return this.props.layers.some(function(e){return"function"==typeof e})?this.props.layers.map(function(e){return"function"==typeof e?e():e}):this.props.layers}}()},{key:"render",value:function(){return function(){var e=this.props.viewport;return u.default.createElement(l.default,o({},e,{mapStyle:this.props.mapStyle,onViewportChange:this.onViewportChange,mapboxApiAccessToken:this.props.mapboxApiAccessToken}),u.default.createElement(c.default,o({},e,{layers:this.layers(),initWebGLParameters:!0})))}}()}],[{key:"getDerivedStateFromProps",value:function(){return function(e,t){return e.viewport!==t.viewport?{viewport:Object.assign({},e.viewport),previousViewport:t.viewport}:null}}()}]),t}();t.default=v,v.propTypes=p,v.defaultProps=d},2548:function(e,t){},2549:function(e,t){},2550:function(e,t){},477:function(e,t,r){var n=r(222);e.exports=function(e,t){return n(e,t)}}}]);