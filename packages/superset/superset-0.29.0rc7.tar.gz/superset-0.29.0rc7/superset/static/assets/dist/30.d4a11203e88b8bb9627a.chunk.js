(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{1562:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLayer=s;var n,o=r(2532),a=r(2525),i=r(2526),u=(n=i)&&n.__esModule?n:{default:n},l=r(2539);function s(e,t,r,n){var i=e,l=i.color_picker,s=t.data.features.map(function(e){return Object.assign({},e,{color:[l.r,l.g,l.b,255*l.a]})});i.js_data_mutator&&(s=(0,u.default)(i.js_data_mutator)(s));var f=(0,a.getAggFunc)(i.js_agg_function,function(e){return e.weight});return new o.HexagonLayer(Object.assign({id:"hex-layer-"+i.slice_id,data:s,pickable:!0,radius:i.grid_size,minColor:[0,0,0,0],extruded:i.extruded,maxColor:[l.r,l.g,l.b,255*l.a],outline:!1,getElevationValue:f,getColorValue:f},(0,a.commonLayerProps)(i,n)))}t.default=(0,l.createDeckGLComponent)(s,function(e){return e.map(function(e){return e.position})})},1652:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return n.default.createElement("span",{className:"BootstrapSliderWrapper"},n.default.createElement(o.default,e))};var n=a(r(1)),o=a(r(1654));function a(e){return e&&e.__esModule?e:{default:e}}r(1655),r(1653)},1653:function(e,t,r){},2525:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBounds=l,t.fitViewport=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;try{var n=l(t);return Object.assign({},e,(0,o.fitBounds)({height:e.height,width:e.width,padding:r,bounds:n}))}catch(t){return console.error("Could not auto zoom",t),e}},t.commonLayerProps=function(e,t,r){var o=e,a=void 0,u=void 0;if(o.js_tooltip)u=(0,i.default)(o.js_tooltip);else if(o.line_column&&o.metric&&["geohash","zipcode"].indexOf(o.line_type)>=0){var l=o.metric.label||o.metric;u=function(){return function(e){return n.default.createElement("div",null,n.default.createElement("div",null,o.line_column,": ",n.default.createElement("strong",null,e.object[o.line_column])),o.metric&&n.default.createElement("div",null,l,": ",n.default.createElement("strong",null,e.object[l])))}}()}u&&(a=function(){return function(e){e.picked?t({content:u(e),x:e.x,y:e.y}):t(null)}}());var s=void 0;o.js_onclick_href?s=function(){return function(e){var t=(0,i.default)(o.js_onclick_href)(e);window.open(t)}}():o.table_filter&&void 0!==r&&(s=function(){return function(e){return r(e.object[o.line_column])}}());return{onClick:s,onHover:a,pickable:Boolean(a)}},t.getAggFunc=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sum",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("count"===e)return function(e){return e.length};var r=void 0;r=e in s?function(){return function(r,n){var o=void 0;o=t?r.sort(function(e,r){return a.ascending(t(e),t(r))}):r.sort(a.ascending);return a.quantile(o,s[e],n)}}():a[e];if(!t)return function(e){return r(e)};return function(e){return r(e.map(t))}};var n=u(r(1)),o=r(2535),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(17)),i=u(r(2526));function u(e){return e&&e.__esModule?e:{default:e}}function l(e){var t=a.extent(e,function(e){return e[1]}),r=a.extent(e,function(e){return e[0]});return[[r[0],t[0]],[r[1],t[1]]]}var s={p1:.01,p5:.05,p95:.95,p99:.99}},2526:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){var o={},a="SAFE_EVAL_"+Math.floor(1e6*Math.random());o[a]={};var i=a+"="+e,u=Object.assign({},s,t);Object.keys(u).forEach(function(e){o[e]=u[e]});try{return n.default.runInNewContext(i,o,r),o[a]}catch(e){return function(){return e}}};var n=l(r(2553)),o=l(r(2554)),a=u(r(17)),i=u(r(2528));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function l(e){return e&&e.__esModule?e:{default:e}}var s={console:console,_:o.default,colors:i,d3array:a}},2528:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hexToRGB=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;if(!e)return[0,0,0,t];var r=(0,n.rgb)(e),o=r.r,a=r.g,i=r.b;return[o,a,i,t]};var n=r(42)},2531:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(477)),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=f(r(1)),u=f(r(0)),l=f(r(2547)),s=f(r(2532));function f(e){return e&&e.__esModule?e:{default:e}}r(2555);var c=2e3,p={viewport:u.default.object.isRequired,layers:u.default.array.isRequired,setControlValue:u.default.func,mapStyle:u.default.string,mapboxApiAccessToken:u.default.string.isRequired,onViewportChange:u.default.func},d={mapStyle:"light",onViewportChange:function(){return function(){}}(),setControlValue:function(){return function(){}}()},h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.tick=r.tick.bind(r),r.onViewportChange=r.onViewportChange.bind(r),r.state={previousViewport:e.viewport,timer:setInterval(r.tick,c)},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i["default"].Component),a(t,[{key:"componentWillUnmount",value:function(){return function(){clearInterval(this.state.timer)}}()},{key:"onViewportChange",value:function(){return function(e){var t=Object.assign({},e),r=Object.assign({},this.state.previousViewport,t);this.props.onViewportChange(r)}}()},{key:"tick",value:function(){return function(){var e=this;if(this.state&&!(0,n.default)(this.state.previousViewport,this.props.viewport)){var t=this.props.setControlValue,r=this.props.viewport;t&&t("viewport",r),this.setState(function(){return{previousViewport:e.props.viewport}})}}}()},{key:"layers",value:function(){return function(){return this.props.layers.some(function(e){return"function"==typeof e})?this.props.layers.map(function(e){return"function"==typeof e?e():e}):this.props.layers}}()},{key:"render",value:function(){return function(){var e=this.props.viewport;return i.default.createElement(l.default,o({},e,{mapStyle:this.props.mapStyle,onViewportChange:this.onViewportChange,mapboxApiAccessToken:this.props.mapboxApiAccessToken}),i.default.createElement(s.default,o({},e,{layers:this.layers(),initWebGLParameters:!0})))}}()}],[{key:"getDerivedStateFromProps",value:function(){return function(e,t){return e.viewport!==t.viewport?{viewport:Object.assign({},e.viewport),previousViewport:t.viewport}:null}}()}]),t}();t.default=h,h.propTypes=p,h.defaultProps=d},2536:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=s(r(1)),i=s(r(0)),u=s(r(2531)),l=s(r(2540));function s(e){return e&&e.__esModule?e:{default:e}}var f=20,c={getLayers:i.default.func.isRequired,start:i.default.number.isRequired,end:i.default.number.isRequired,getStep:i.default.func,values:i.default.array.isRequired,aggregation:i.default.bool,disabled:i.default.bool,viewport:i.default.object.isRequired,children:i.default.node,onViewportChange:i.default.func,onValuesChange:i.default.func},p={aggregation:!1,disabled:!1,onViewportChange:function(){return function(){}}(),onValuesChange:function(){return function(){}}()},d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),n=(e.getLayers,e.start,e.end,e.getStep,e.values,e.disabled,e.viewport,function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["getLayers","start","end","getStep","values","disabled","viewport"]));return r.other=n,r.onViewportChange=r.onViewportChange.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].Component),o(t,[{key:"onViewportChange",value:function(){return function(e){var t=this.props.disabled?Object.assign({},e):Object.assign({},e,{height:e.height+f});this.props.onViewportChange(t)}}()},{key:"render",value:function(){return function(){var e=this.props,t=e.start,r=e.end,o=e.getStep,i=e.disabled,s=e.aggregation,c=e.children,p=e.getLayers,d=e.values,h=e.onValuesChange,y=e.viewport,v=p(d),b=Object.assign({},y,{height:i?y.height:y.height-f});return a.default.createElement("div",null,a.default.createElement(u.default,n({},this.other,{viewport:b,layers:v,onViewportChange:this.onViewportChange})),!i&&a.default.createElement(l.default,{start:t,end:r,step:o(t),values:d,range:!s,onChange:h}),c)}}()}]),t}();t.default=d,d.propTypes=c,d.defaultProps=p},2537:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPlaySliderParams=void 0,t.truncate=l;var n,o=r(8),a=(n=o)&&n.__esModule?n:{default:n};function i(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var u=[1,0,1,0,0,0,0];function l(e,t){var r=(0,a.default)(e).subtract(t),n=e.toArray(),o=r.toArray(),i=n.map(function(e,t){return o[t]!==e}).indexOf(!0),l=n.map(function(e,t){if(t===i){var r=e-o[t];return e-(e-u[t])%r}return t<i||-1===i?e:u[t]});return(0,a.default)(l)}t.getPlaySliderParams=function(){return function(e,t){var r=(0,a.default)(Math.min.apply(Math,i(e))),n=(0,a.default)(Math.max.apply(Math,i(e))),o=void 0,u=void 0;if(-1!==t.indexOf("/")){var s=t.split("/",2);s[0].endsWith("Z")?(u=(0,a.default)(s[0]),o=a.default.duration(s[1])):(u=(0,a.default)(s[1]),o=a.default.duration(s[0]))}else u=l(r,o=a.default.duration(t));for(var f=(0,a.default)(u);f<r;)f.add(o);for(;f>r;)f.subtract(o);for(var c=(0,a.default)(u);c>n;)c.subtract(o);for(;c<n;)c.add(o);var p=null!=t?[f,(0,a.default)(f).add(o)]:[f,c],d=e.every(function(e){return null===e});return{start:parseInt(f.format("x"),10),end:parseInt(c.format("x"),10),getStep:function(e,t){var r=parseInt((0,a.default)(t).format("x"),10);return parseInt((0,a.default)(t).add(e).format("x"),10)-r}.bind(this,o),values:p.map(function(e){return parseInt(e.format("x"),10)}),disabled:d}}}()},2539:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=f(r(477)),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.createDeckGLComponent=function(e,t){var r=function(r){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e)),n=e.viewport,o=e.formData.autozoom?(0,s.fitViewport)(n,t(e.payload.data.features)):n;return r.state={viewport:o,layer:r.computeLayer(e)},r.onViewportChange=r.onViewportChange.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,r),o(i,[{key:"componentWillReceiveProps",value:function(){return function(e){var t=Object.assign({},e.formData,{viewport:null}),r=Object.assign({},this.props.formData,{viewport:null});(0,n.default)(t,r)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})}}()},{key:"onViewportChange",value:function(){return function(e){this.setState({viewport:e})}}()},{key:"computeLayer",value:function(){return function(t){var r=t.formData,n=t.payload,o=t.onAddFilter,a=t.setTooltip;return e(r,n,o,a)}}()},{key:"render",value:function(){return function(){var e=this.props,t=e.formData,r=e.payload,n=e.setControlValue,o=this.state,i=o.layer,l=o.viewport;return a.default.createElement(u.default,{mapboxApiAccessToken:r.data.mapboxApiKey,viewport:l,layers:[i],mapStyle:t.mapbox_style,setControlValue:n,onViewportChange:this.onViewportChange})}}()}]),i}(a.default.PureComponent);return r.propTypes=c,r.defaultProps=p,r},t.createCategoricalDeckGLComponent=function(e,t){function r(r){var n=r.formData,o=r.payload,i=r.setControlValue,u=r.onAddFilter,s=r.setTooltip,f=r.viewport;return a.default.createElement(l.default,{formData:n,mapboxApiKey:o.data.mapboxApiKey,setControlValue:i,viewport:f,getLayer:e,payload:o,onAddFilter:u,setTooltip:s,getPoints:t})}return r.propTypes=c,r.defaultProps=p,r};var a=f(r(1)),i=f(r(0)),u=f(r(2531)),l=f(r(2546)),s=r(2525);function f(e){return e&&e.__esModule?e:{default:e}}var c={formData:i.default.object.isRequired,payload:i.default.object.isRequired,setControlValue:i.default.func.isRequired,viewport:i.default.object.isRequired,onAddFilter:i.default.func,setTooltip:i.default.func},p={onAddFilter:function(){return function(){}}(),setTooltip:function(){return function(){}}()}},2540:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(r(1)),a=s(r(0)),i=s(r(1656)),u=r(10),l=s(r(1652));function s(e){return e&&e.__esModule?e:{default:e}}r(2541);var f={start:a.default.number.isRequired,step:a.default.number.isRequired,end:a.default.number.isRequired,values:a.default.array.isRequired,onChange:a.default.func,loopDuration:a.default.number,maxFrames:a.default.number,orientation:a.default.oneOf(["horizontal","vertical"]),reversed:a.default.bool,disabled:a.default.bool,range:a.default.bool},c={onChange:function(){return function(){}}(),loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0},p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.state={intervalId:null};var n=e.end-e.start,o=Math.min(e.maxFrames,n/e.step),a=n/o;return r.intervalMilliseconds=e.loopDuration/o,r.increment=a<e.step?e.step:a-a%e.step,r.onChange=r.onChange.bind(r),r.play=r.play.bind(r),r.pause=r.pause.bind(r),r.stepBackward=r.stepBackward.bind(r),r.stepForward=r.stepForward.bind(r),r.getPlayClass=r.getPlayClass.bind(r),r.formatter=r.formatter.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].PureComponent),n(t,[{key:"componentDidMount",value:function(){return function(){i.default.bind(["space"],this.play)}}()},{key:"componentWillUnmount",value:function(){return function(){i.default.unbind(["space"])}}()},{key:"onChange",value:function(){return function(e){this.props.onChange(e.target.value),null!=this.state.intervalId&&this.pause()}}()},{key:"getPlayClass",value:function(){return function(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"}}()},{key:"play",value:function(){return function(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{var e=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:e})}}}()},{key:"pause",value:function(){return function(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}}()},{key:"stepForward",value:function(){return function(){var e=this,t=this.props,r=t.start,n=t.end,o=t.step,a=t.values;if(!t.disabled){var i=(Array.isArray(a)?a:[a,a+o]).map(function(t){return t+e.increment}),u=i[1]>n?i[0]-r:0;this.props.onChange(i.map(function(e){return e-u}))}}}()},{key:"stepBackward",value:function(){return function(){var e=this,t=this.props,r=t.start,n=t.end,o=t.step,a=t.values;if(!t.disabled){var i=(Array.isArray(a)?a:[a,a+o]).map(function(t){return t-e.increment}),u=i[0]<r?n-i[1]:0;this.props.onChange(i.map(function(e){return e+u}))}}}()},{key:"formatter",value:function(){return function(e){if(this.props.disabled)return(0,u.t)("Data has no time steps");var t=e;return Array.isArray(e)?e[0]===e[1]&&(t=[e[0]]):t=[e],t.map(function(e){return new Date(e).toUTCString()}).join(" : ")}}()},{key:"render",value:function(){return function(){var e=this.props,t=e.start,r=e.end,n=e.step,a=e.orientation,i=e.reversed,u=e.disabled,s=e.range,f=e.values;return o.default.createElement("div",{className:"play-slider"},o.default.createElement("div",{className:"play-slider-controls padded"},o.default.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),o.default.createElement("i",{className:this.getPlayClass(),onClick:this.play}),o.default.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),o.default.createElement("div",{className:"play-slider-scrobbler padded"},o.default.createElement(l.default,{value:s?f:f[0],range:s,formatter:this.formatter,change:this.onChange,min:t,max:r,step:n,orientation:a,reversed:i,disabled:u?"disabled":"enabled"})))}}()}]),t}();t.default=p,p.propTypes=f,p.defaultProps=c},2541:function(e,t,r){},2542:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=u(r(1)),i=u(r(0));function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r(2543);var s={categories:i.default.object,toggleCategory:i.default.func,showSingleCategory:i.default.func,position:i.default.oneOf([null,"tl","tr","bl","br"])},f={categories:{},toggleCategory:function(){return function(){}}(),showSingleCategory:function(){return function(){}}(),position:"tr"},c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"].PureComponent),o(t,[{key:"render",value:function(){return function(){var e,t=this;if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;var r=Object.entries(this.props.categories).map(function(e){var r=n(e,2),o=r[0],i=r[1],u={color:"rgba("+i.color.join(", ")+")"},l=i.enabled?"●":"○";return a.default.createElement("li",{key:o},a.default.createElement("a",{href:"#",onClick:function(){return t.props.toggleCategory(o)},onDoubleClick:function(){return t.props.showSingleCategory(o)}},a.default.createElement("span",{style:u},l)," ",o))}),o="t"===this.props.position.charAt(0)?"top":"bottom",i="r"===this.props.position.charAt(1)?"right":"left",u=(l(e={position:"absolute"},o,"0px"),l(e,i,"10px"),e);return a.default.createElement("div",{className:"legend",style:u},a.default.createElement("ul",{className:"categories"},r))}}()}]),t}();t.default=c,c.propTypes=s,c.defaultProps=f},2543:function(e,t,r){},2546:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=d(r(1)),a=d(r(0)),i=r(229),u=d(r(2536)),l=d(r(2542)),s=r(2528),f=r(2537),c=d(r(2526)),p=r(2525);function d(e){return e&&e.__esModule?e:{default:e}}var h=i.CategoricalColorNamespace.getScale;var y={formData:a.default.object.isRequired,mapboxApiKey:a.default.string.isRequired,setControlValue:a.default.func.isRequired,viewport:a.default.object.isRequired,getLayer:a.default.func.isRequired,getPoints:a.default.func.isRequired,payload:a.default.object.isRequired,onAddFilter:a.default.func,setTooltip:a.default.func},v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state=t.getDerivedStateFromProps(e),r.getLayers=r.getLayers.bind(r),r.onValuesChange=r.onValuesChange.bind(r),r.onViewportChange=r.onViewportChange.bind(r),r.toggleCategory=r.toggleCategory.bind(r),r.showSingleCategory=r.showSingleCategory.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o["default"].PureComponent),n(t,[{key:"onValuesChange",value:function(){return function(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}}()},{key:"onViewportChange",value:function(){return function(e){this.setState({viewport:e})}}()},{key:"getLayers",value:function(){return function(e){var t=this.props,r=t.getLayer,n=t.payload,o=t.formData,a=t.onAddFilter,i=t.setTooltip,u=n.data.features?[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(n.data.features)):[];u=this.addColor(u,o),o.js_data_mutator&&(u=(0,c.default)(o.js_data_mutator)(u)),u=e[0]===e[1]||e[1]===this.end?u.filter(function(t){return t.__timestamp>=e[0]&&t.__timestamp<=e[1]}):u.filter(function(t){return t.__timestamp>=e[0]&&t.__timestamp<e[1]});var l=this.state.categories;return o.dimension&&(u=u.filter(function(e){return l[e.cat_color]&&l[e.cat_color].enabled})),[r(o,Object.assign({},n,{data:Object.assign({},n.data,{features:u})}),a,i)]}}()},{key:"addColor",value:function(){return function(e,t){var r=t.color_picker||{r:0,g:0,b:0,a:1},n=h(t.color_scheme);return e.map(function(e){var o=void 0;return t.dimension?(o=(0,s.hexToRGB)(n(e.cat_color),255*r.a),Object.assign({},e,{color:o})):e})}}()},{key:"toggleCategory",value:function(){return function(e){var t=this.state.categories[e];t.enabled=!t.enabled;var r,n,o,a=Object.assign({},this.state.categories,(o=t,(n=e)in(r={})?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o,r));Object.values(a).every(function(e){return!e.enabled})&&Object.values(a).forEach(function(e){e.enabled=!0}),this.setState({categories:a})}}()},{key:"showSingleCategory",value:function(){return function(e){var t=Object.assign({},this.state.categories);Object.values(t).forEach(function(e){e.enabled=!1}),t[e].enabled=!0,this.setState({categories:t})}}()},{key:"render",value:function(){return function(){return o.default.createElement("div",{style:{position:"relative"}},o.default.createElement(u.default,{getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,onValuesChange:this.onValuesChange,disabled:this.state.disabled,viewport:this.state.viewport,onViewportChange:this.onViewportChange,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue},o.default.createElement(l.default,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position})))}}()}],[{key:"getDerivedStateFromProps",value:function(){return function(e,t){var r=e.payload.data.features||[],n=r.map(function(e){return e.__timestamp}),o=function(e,t){var r=e.color_picker||{r:0,g:0,b:0,a:1},n=[r.r,r.g,r.b,255*r.a],o=h(e.color_scheme),a={};return t.forEach(function(t){if(null!=t.cat_color&&!a.hasOwnProperty(t.cat_color)){var i=void 0;i=e.dimension?(0,s.hexToRGB)(o(t.cat_color),255*r.a):n,a[t.cat_color]={color:i,enabled:!0}}}),a}(e.formData,r);if(t&&e.payload.form_data===t.formData)return Object.assign({},t,{categories:o});var a=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",i=(0,f.getPlaySliderParams)(n,a);return{start:i.start,end:i.end,getStep:i.getStep,values:i.values,disabled:i.disabled,viewport:e.formData.autozoom?(0,p.fitViewport)(e.viewport,e.getPoints(r)):e.viewport,selected:[],lastClick:0,formData:e.payload.form_data,categories:o}}}()}]),t}();t.default=v,v.propTypes=y},2548:function(e,t){},2549:function(e,t){},2550:function(e,t){}}]);