- model: test
  operations:
    gen-output:
      main: echo ${msg}
      flags:
        msg:
          default: hi
          arg-skip: yes
    gen-files:
      main: write ${count} ${msg}
      flags:
        count:
          default: 1
          arg-skip: yes
        msg:
          default: hi
          arg-skip: yes
      requires: sample-file
  resources:
    sample-file:
      sources:
        - sample.txt

- test: output-1
  steps:
    - run: gen-output
      expect:
        - output: hi

- test: output-2
  steps:
    - run: gen-output
      flags:
        msg: hello car
      expect:
        - output: hello
        - output: car

- test: file-1
  steps:
    - run: gen-files
      disable-plugins: all
      flags:
        count: 1
        msg: hello bus
      expect:
        - file: file-1
          contains: bus
        - file: sample.txt

- test: fail-1
  steps:
    - run: gen-output
      disable-plugins: all
      expect:
        - output: bye

- test: all
  steps:
    - for-each-model:
        steps:
          - run: gen-output
            disable-plugins: all
          - run: gen-files
            disable-plugins: all
