(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{44:function(e,t,a){e.exports=a(74)},49:function(e,t,a){},74:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(14),i=a.n(s),c=(a(49),a(2)),o=a.n(c),l=a(4),u=a(6),d=a(7),p=a(8),m=a(5),h=a(9),g=a(76),v=a(79),f=a(17),b=a(34),E=a(77),y=function(e){var t=e.component,a=e.render,n=e.authed,s=e.to,i=void 0===s?"/login":s,c=Object(f.a)(e,["component","render","authed","to"]);return r.a.createElement(b.a,Object.assign({},c,{render:function(e){return!0===n?t?r.a.createElement(t,e):a():r.a.createElement(E.a,{to:{pathname:i}})}}))},w=function(e){return r.a.createElement("div",Object.assign({},e,{className:"spinner ".concat(e.className||"")}),r.a.createElement("svg",{viewBox:"25 25 50 50"},r.a.createElement("circle",{cx:"50",cy:"50",r:"20",fill:"none",strokeWidth:"2",strokeMiterlimit:"10"})))},O="/_matrix/maubot/v1";function N(){return{"Content-Type":arguments.length>0&&void 0!==arguments[0]?arguments[0]:"application/json",Authorization:"Bearer ".concat(localStorage.accessToken)}}function k(e,t){return j.apply(this,arguments)}function j(){return(j=Object(l.a)(o.a.mark(function e(t,a){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(O,"/").concat(t,"/").concat(a),{headers:N(),method:"DELETE"});case 2:if(204!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",{success:!0});case 5:return e.next=7,n.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function x(e,t){return S.apply(this,arguments)}function S(){return(S=Object(l.a)(o.a.mark(function e(t,a){var n,r,s=arguments;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:void 0,e.next=3,fetch("".concat(O,"/").concat(t,"/").concat(n||a.id),{headers:N(),body:JSON.stringify(a),method:"PUT"});case 3:return r=e.sent,e.next=6,r.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function C(e){return L.apply(this,arguments)}function L(){return(L=Object(l.a)(o.a.mark(function e(t){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(O).concat(t),{headers:N()});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function P(){return(P=Object(l.a)(o.a.mark(function e(t,a){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(O,"/auth/login"),{method:"POST",body:JSON.stringify({username:t,password:a})});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function I(){return(I=Object(l.a)(o.a.mark(function e(){var t,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(O,"/auth/ping"),{method:"POST",headers:N()});case 2:return t=e.sent,e.next=5,t.json();case 5:if(!(a=e.sent).username){e.next=10;break}return e.abrupt("return",a.username);case 10:if("auth_token_missing"!==a.errcode&&"auth_token_invalid"!==a.errcode){e.next=12;break}return e.abrupt("return",null);case 12:throw a;case 13:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function A(){return(A=Object(l.a)(o.a.mark(function e(){var t,a,n,r,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="https:"===window.location.protocol?"wss:":"ws:",a="".concat(t,"//").concat(window.location.host).concat(O,"/logs"),n={socket:null,connected:!1,authenticated:!1,onLog:function(e){},fails:-1},r=function(){n.socket.send(localStorage.accessToken),n.connected=!0},s=function(e){var t=JSON.parse(e.data);void 0!==t.auth_success?t.auth_success?(console.info("Websocket connection authentication successful"),n.authenticated=!0,n.fails=-1):console.info("Websocket connection authentication failed"):(t.time=new Date(t.time),console.log("SERVLOG",t),n.onLog(t))},function e(t){t&&(4e3===t.code?console.error("Websocket connection failed: access token invalid or not provided"):1012===t.code&&console.info("Websocket connection closed: server is restarting")),n.connected=!1,n.socket=null,n.fails++;setTimeout(function(){n.socket=new WebSocket(a),n.socket.onopen=r,n.socket.onmessage=s,n.socket.onclose=e},Math.min(5*n.fails*1e3,3e4))}(),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function T(){return(T=Object(l.a)(o.a.mark(function e(t,a){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=6;break}return e.next=3,fetch("".concat(O,"/plugin/").concat(a),{headers:N("application/zip"),body:t,method:"PUT"});case 3:n=e.sent,e.next=9;break;case 6:return e.next=8,fetch("".concat(O,"/plugins/upload"),{headers:N("application/zip"),body:t,method:"POST"});case 8:n=e.sent;case 9:return e.next=11,n.json();case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function W(){return(W=Object(l.a)(o.a.mark(function e(t,a,n){var r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(O,"/client/").concat(t,"/avatar"),{headers:N(n),body:a,method:"POST"});case 2:return r=e.sent,e.next=5,r.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var _={BASE_PATH:O,login:function(e,t){return P.apply(this,arguments)},ping:function(){return I.apply(this,arguments)},openLogSocket:function(){return A.apply(this,arguments)},getInstances:function(){return C("/instances")},getInstance:function(e){return C("/instance/".concat(e))},putInstance:function(e,t){return x("instance",e,t)},deleteInstance:function(e){return k("instance",e)},getPlugins:function(){return C("/plugins")},getPlugin:function(e){return C("/plugin/".concat(e))},uploadPlugin:function(e,t){return T.apply(this,arguments)},deletePlugin:function(e){return k("plugin",e)},getClients:function(){return C("/clients")},getClient:function(e){return C("/clients/".concat(e))},uploadAvatar:function(e,t,a){return W.apply(this,arguments)},getAvatarURL:function(e){return"".concat(O,"/client/").concat(e,"/avatar?access_token=").concat(localStorage.accessToken)},putClient:function(e){return x("client",e)},deleteClient:function(e){return k("client",e)}},M=a(15),F=a(41),D=a(18),V=a(73),H=a(78);function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var R=r.a.createElement("path",{fill:"#000000",d:"M17,13H13V17H11V13H7V11H11V7H13V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"});const B=e=>r.a.createElement("svg",U({xmlnsXlink:"http://www.w3.org/1999/xlink",version:1.1,width:24,height:24,viewBox:"0 0 24 24"},e),R);a.p;var z=a(42),J=a(75),K=a(35),Z=a.n(K);a(62),a(63);function G(){return(G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var X=r.a.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),Y=r.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"});const Q=e=>r.a.createElement("svg",G({width:24,height:24,viewBox:"0 0 24 24"},e),X,Y);a.p;var $=a(43),q=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(p.a)(this,Object(m.a)(t).call(this,e))).toggle=function(){a.props.onToggle?a.props.onToggle(!a.state.active):a.setState({active:!a.state.active})},a.toggleKeyboard=function(e){return(" "===e.key||"Enter"===e.key)&&a.toggle()},a.state={active:e.active},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({active:e.active})}},{key:"render",value:function(){return r.a.createElement("div",{className:"switch","data-active":this.state.active,onClick:this.toggle,tabIndex:"0",onKeyPress:this.toggleKeyboard,id:this.props.id},r.a.createElement("div",{className:"box"},r.a.createElement("span",{className:"text"},r.a.createElement("span",{className:"on"},this.props.onText||"On"),r.a.createElement("span",{className:"off"},this.props.offText||"Off"))))}}]),t}(n.Component),ee=function(e){var t=e.children,a=e.wrapperClass;return a?r.a.createElement("div",{className:a},r.a.createElement("div",{className:"preference-table"},t)):r.a.createElement("div",{className:"preference-table"},t)},te=function(e){var t=e.name,a=e.fullWidth,n=void 0!==a&&a,s=e.labelFor,i=void 0===s?void 0:s,c=e.children;return r.a.createElement("div",{className:"entry ".concat(n?"full-width":"")},r.a.createElement("label",{htmlFor:i},t),r.a.createElement("div",{className:"value"},c))},ae=function(e){var t=e.rowName,a=e.fullWidth,n=void 0!==a&&a,s=Object(f.a)(e,["rowName","fullWidth"]);return r.a.createElement(te,{name:t,fullWidth:n,labelFor:t},r.a.createElement("input",Object.assign({},s,{id:t})))},ne=function(e){var t=e.rowName,a=e.fullWidth,n=void 0!==a&&a,s=Object(f.a)(e,["rowName","fullWidth"]);return r.a.createElement(te,{name:t,fullWidth:n,labelFor:t},r.a.createElement(q,Object.assign({},s,{id:t})))},re=function(e){var t=e.rowName,a=e.fullWidth,n=void 0!==a&&a,s=Object(f.a)(e,["rowName","fullWidth"]);return r.a.createElement(te,{name:t,fullWidth:n,labelFor:t},r.a.createElement($.a,Object.assign({className:"select"},s,{id:t})))},se=ee,ie=function(e){var t=e.lines,a=e.showName,n=void 0===a||a;return r.a.createElement("div",{className:"log"},t.map(function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"row",key:e.id},r.a.createElement("span",{className:"time"},e.time.toLocaleTimeString()),r.a.createElement("span",{className:"level"},e.levelname),n&&r.a.createElement("span",{className:"logger"},e.name),r.a.createElement("span",{className:"text"},e.msg)),e.exc_info&&r.a.createElement("div",{className:"row exception",key:e.id+"-exc"},e.exc_info.replace(/\\n/g,"\n")))}))},ce=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(p.a)(this,Object(m.a)(t).call(this,e))).delete=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(window.confirm("Are you sure you want to delete ".concat(a.state.id,"?"))){e.next=2;break}return e.abrupt("return");case 2:return a.setState({deleting:!0}),e.next=5,a.deleteFunc(a.state.id);case 5:(t=e.sent).success?(a.props.history.push("/"),a.props.onDelete()):a.setState({deleting:!1,error:t.error});case 7:case"end":return e.stop()}},e,this)})),a.inputChange=function(e){e.target.name&&a.setState(Object(M.a)({},e.target.name,e.target.value))},a.renderInstances=function(){return!a.isNew&&r.a.createElement("div",{className:"instances"},r.a.createElement("h3",null,a.hasInstances?"Instances":"No instances :("),a.state.instances.map(function(e){return r.a.createElement(V.a,{className:"instance",key:e.id,to:"/instance/".concat(e.id)},e.id)}))},a.renderLog=function(){return!a.isNew&&r.a.createElement(ie,{showName:!1,lines:a.props.log})},a.state=Object.assign(a.initialState,e.entry),a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState(Object.assign(this.initialState,e.entry))}},{key:"readFile",value:function(){var e=Object(l.a)(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,a){var n=new FileReader;n.readAsArrayBuffer(t),n.onload=function(t){return e(t.target.result)},n.onerror=function(e){return a(e)}}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"initialState",get:function(){throw Error("Not implemented")}},{key:"hasInstances",get:function(){return this.state.instances&&this.state.instances.length>0}},{key:"isNew",get:function(){return!this.props.entry}}]),t}(n.Component),oe=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(p.a)(this,Object(m.a)(t).call(this,e))).clientSelectEntry=function(e){return e&&{id:e.id,value:e.id,label:r.a.createElement("div",{className:"select-client"},r.a.createElement("img",{className:"avatar",src:_.getAvatarURL(e.id),alt:""}),r.a.createElement("span",{className:"displayname"},e.displayname||e.id))}},a.save=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({saving:!0}),e.next=3,_.putInstance(a.instanceInState,a.props.entry?a.props.entry.id:void 0);case 3:(t=e.sent).id?(a.isNew?a.props.history.push("/instance/".concat(t.id)):(t.id!==a.props.entry.id&&a.props.history.replace("/instance/".concat(t.id)),a.setState({saving:!1,error:""})),a.props.onChange(t)):a.setState({saving:!1,error:t.error});case 5:case"end":return e.stop()}},e,this)})),a.deleteFunc=_.deleteInstance,a.updateClientOptions(),a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"componentWillReceiveProps",value:function(e){Object(z.a)(Object(m.a)(t.prototype),"componentWillReceiveProps",this).call(this,e),this.updateClientOptions()}},{key:"updateClientOptions",value:function(){this.clientOptions=Object.values(this.props.ctx.clients).map(this.clientSelectEntry)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"instance"},r.a.createElement(se,null,r.a.createElement(ae,{rowName:"ID",type:"text",name:"id",value:this.state.id,placeholder:"fancybotinstance",onChange:this.inputChange,disabled:!this.isNew,fullWidth:!0,className:"id"}),r.a.createElement(ne,{rowName:"Enabled",active:this.state.enabled,onToggle:function(t){return e.setState({enabled:t})}}),r.a.createElement(ne,{rowName:"Running",active:this.state.started,onToggle:function(t){return e.setState({started:t})}}),r.a.createElement(re,{rowName:"Primary user",options:this.clientOptions,isSearchable:!1,value:this.selectedClientEntry,onChange:function(t){var a=t.id;return e.setState({primary_user:a})}}),r.a.createElement(re,{rowName:"Type",options:this.typeOptions,isSearchable:!1,value:this.selectedPluginEntry,onChange:function(t){var a=t.id;return e.setState({type:a})}})),!this.isNew&&r.a.createElement(Z.a,{mode:"yaml",theme:"github",onChange:function(t){return e.setState({config:t})},name:"config",value:this.state.config,editorProps:{fontSize:"10pt",$blockScrolling:!0}}),r.a.createElement("div",{className:"buttons"},!this.isNew&&r.a.createElement("button",{className:"delete",onClick:this.delete,disabled:this.loading},this.state.deleting?r.a.createElement(w,null):"Delete"),r.a.createElement("button",{className:"save ".concat(this.isValid?"":"disabled-bg"),onClick:this.save,disabled:this.loading||!this.isValid},this.state.saving?r.a.createElement(w,null):this.isNew?"Create":"Save")),r.a.createElement("div",{className:"error"},this.state.error),this.renderLog())}},{key:"initialState",get:function(){return{id:"",primary_user:"",enabled:!0,started:!0,type:"",config:"",saving:!1,deleting:!1,error:""}}},{key:"instanceInState",get:function(){var e=Object.assign({},this.state);return delete e.saving,delete e.deleting,delete e.error,e}},{key:"selectedClientEntry",get:function(){return this.state.primary_user?this.clientSelectEntry(this.props.ctx.clients[this.state.primary_user]):{}}},{key:"selectedPluginEntry",get:function(){return{id:this.state.type,value:this.state.type,label:this.state.type}}},{key:"typeOptions",get:function(){return Object.values(this.props.ctx.plugins).map(function(e){return e&&{id:e.id,value:e.id,label:e.id}})}},{key:"loading",get:function(){return this.state.deleting||this.state.saving}},{key:"isValid",get:function(){return this.state.id&&this.state.primary_user&&this.state.type}}]),t}(ce);oe.ListEntry=function(e){var t=e.entry;return r.a.createElement(J.a,{className:"instance entry",to:"/instance/".concat(t.id)},r.a.createElement("span",{className:"id"},t.id),r.a.createElement(Q,null))};var le=Object(H.a)(oe);function ue(){return(ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var de=r.a.createElement("path",{fill:"#000000",d:"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z"});const pe=e=>r.a.createElement("svg",ue({xmlnsXlink:"http://www.w3.org/1999/xlink",version:1.1,width:24,height:24,viewBox:"0 0 24 24"},e),de);a.p;var me=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(p.a)(this,Object(m.a)(t).call(this,e))).avatarUpload=function(){var e=Object(l.a)(o.a.mark(function e(t){var n,r,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.files[0],a.setState({uploadingAvatar:!0}),e.next=4,a.readFile(n);case 4:return r=e.sent,e.next=7,_.uploadAvatar(a.state.id,r,n.type);case 7:s=e.sent,a.setState({uploadingAvatar:!1,avatar_url:s.content_uri});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.save=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({saving:!0}),e.next=3,_.putClient(a.clientInState);case 3:(t=e.sent).id?(a.isNew?a.props.history.push("/client/".concat(t.id)):a.setState({saving:!1,error:""}),a.props.onChange(t)):a.setState({saving:!1,error:t.error});case 5:case"end":return e.stop()}},e,this)})),a.startOrStop=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({startingOrStopping:!0}),e.next=3,_.putClient({id:a.props.entry.id,started:!a.props.entry.started});case 3:(t=e.sent).id?(a.props.onChange(t),a.setState({startingOrStopping:!1,error:""})):a.setState({startingOrStopping:!1,error:t.error});case 5:case"end":return e.stop()}},e,this)})),a.renderSidebar=function(){return!a.isNew&&r.a.createElement("div",{className:"sidebar"},r.a.createElement("div",{className:"avatar-container ".concat(a.state.avatar_url?"":"no-avatar","\n                        ").concat(a.state.uploadingAvatar?"uploading":"")},r.a.createElement("img",{className:"avatar",src:_.getAvatarURL(a.state.id),alt:"Avatar"}),r.a.createElement(pe,{className:"upload"}),r.a.createElement("input",{className:"file-selector",type:"file",accept:"image/png, image/jpeg",onChange:a.avatarUpload,disabled:a.state.uploadingAvatar,onDragEnter:function(e){return e.target.parentElement.classList.add("drag")},onDragLeave:function(e){return e.target.parentElement.classList.remove("drag")}}),a.state.uploadingAvatar&&r.a.createElement(w,null)),r.a.createElement("div",{className:"started-container"},r.a.createElement("span",{className:"started ".concat(a.props.entry.started,"\n                        ").concat(a.props.entry.enabled?"":"disabled")}),r.a.createElement("span",{className:"text"},a.props.entry.started?"Started":a.props.entry.enabled?"Stopped":"Disabled")),(a.props.entry.started||a.props.entry.enabled)&&r.a.createElement("button",{className:"save",onClick:a.startOrStop,disabled:a.loading},a.state.startingOrStopping?r.a.createElement(w,null):a.props.entry.started?"Stop":"Start"))},a.renderPreferences=function(){return r.a.createElement(ee,null,r.a.createElement(ae,{rowName:"User ID",type:"text",disabled:!a.isNew,fullWidth:!0,name:a.isNew?"id":"",value:a.state.id,className:"id",placeholder:"@fancybot:example.com",onChange:a.inputChange}),r.a.createElement(ae,{rowName:"Homeserver",type:"text",name:"homeserver",value:a.state.homeserver,placeholder:"https://example.com",onChange:a.inputChange}),r.a.createElement(ae,{rowName:"Access token",type:"text",name:"access_token",value:a.state.access_token,onChange:a.inputChange,placeholder:"MDAxYWxvY2F0aW9uIG1hdHJpeC5sb2NhbAowMDEzaWRlbnRpZmllc"}),r.a.createElement(ae,{rowName:"Display name",type:"text",name:"displayname",value:a.state.displayname,placeholder:"My fancy bot",onChange:a.inputChange}),r.a.createElement(ae,{rowName:"Avatar URL",type:"text",name:"avatar_url",value:a.state.avatar_url,onChange:a.inputChange,placeholder:"mxc://example.com/mbmwyoTvPhEQPiCskcUsppko"}),r.a.createElement(ne,{rowName:"Sync",active:a.state.sync,onToggle:function(e){return a.setState({sync:e})}}),r.a.createElement(ne,{rowName:"Autojoin",active:a.state.autojoin,onToggle:function(e){return a.setState({autojoin:e})}}),r.a.createElement(ne,{rowName:"Enabled",active:a.state.enabled,onToggle:function(e){return a.setState({enabled:e,started:e&&a.state.started})}}))},a.renderPrefButtons=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"buttons"},!a.isNew&&r.a.createElement("button",{className:"delete ".concat(a.hasInstances?"disabled-bg":""),onClick:a.delete,disabled:a.loading||a.hasInstances,title:a.hasInstances?"Can't delete client that is in use":""},a.state.deleting?r.a.createElement(w,null):"Delete"),r.a.createElement("button",{className:"save",onClick:a.save,disabled:a.loading},a.state.saving?r.a.createElement(w,null):a.isNew?"Create":"Save")),r.a.createElement("div",{className:"error"},a.state.error))},a.deleteFunc=_.deleteClient,a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"client"},this.renderSidebar(),r.a.createElement("div",{className:"info"},this.renderPreferences(),this.renderPrefButtons(),this.renderInstances())),this.renderLog())}},{key:"initialState",get:function(){return{id:"",displayname:"",homeserver:"",avatar_url:"",access_token:"",sync:!0,autojoin:!0,enabled:!0,started:!1,instances:[],uploadingAvatar:!1,saving:!1,deleting:!1,startingOrStopping:!1,error:""}}},{key:"clientInState",get:function(){var e=Object.assign({},this.state);return delete e.uploadingAvatar,delete e.saving,delete e.deleting,delete e.startingOrStopping,delete e.error,delete e.instances,e}},{key:"loading",get:function(){return this.state.saving||this.state.startingOrStopping||this.state.deleting}}]),t}(ce);me.ListEntry=function(e){var t=e.entry,a=["client","entry"];return t.enabled?t.started||a.push("stopped"):a.push("disabled"),r.a.createElement(J.a,{className:a.join(" "),to:"/client/".concat(t.id)},r.a.createElement("img",{className:"avatar",src:_.getAvatarURL(t.id),alt:""}),r.a.createElement("span",{className:"displayname"},t.displayname||t.id),r.a.createElement(Q,null))};var he=Object(H.a)(me),ge=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(p.a)(this,Object(m.a)(t).call(this,e))).upload=function(){var e=Object(l.a)(o.a.mark(function e(t){var n,r,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.files[0],a.setState({uploadingAvatar:!0}),e.next=4,a.readFile(n);case 4:return r=e.sent,e.next=7,_.uploadPlugin(r,a.state.id);case 7:(s=e.sent).id?(a.isNew?a.props.history.push("/plugin/".concat(s.id)):a.setState({saving:!1,error:""}),a.props.onChange(s)):a.setState({saving:!1,error:s.error});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.deleteFunc=_.deletePlugin,a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"plugin"},!this.isNew&&r.a.createElement(se,null,r.a.createElement(ae,{rowName:"ID",type:"text",value:this.state.id,disabled:!0,className:"id"}),r.a.createElement(ae,{rowName:"Version",type:"text",value:this.state.version,disabled:!0})),r.a.createElement("div",{className:"upload-box ".concat(this.state.uploading?"uploading":"")},r.a.createElement(pe,{className:"upload"}),r.a.createElement("input",{className:"file-selector",type:"file",accept:"application/zip+mbp",onChange:this.upload,disabled:this.state.uploading||this.state.deleting,onDragEnter:function(e){return e.target.parentElement.classList.add("drag")},onDragLeave:function(e){return e.target.parentElement.classList.remove("drag")}}),this.state.uploading&&r.a.createElement(w,null)),!this.isNew&&r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{className:"delete ".concat(this.hasInstances?"disabled-bg":""),onClick:this.delete,disabled:this.loading||this.hasInstances,title:this.hasInstances?"Can't delete plugin that is in use":""},this.state.deleting?r.a.createElement(w,null):"Delete")),r.a.createElement("div",{className:"error"},this.state.error),this.renderInstances(),this.renderLog())}},{key:"initialState",get:function(){return{id:"",version:"",instances:[],uploading:!1,deleting:!1,error:""}}}]),t}(ce);ge.ListEntry=function(e){var t=e.entry;return r.a.createElement(J.a,{className:"plugin entry",to:"/plugin/".concat(t.id)},r.a.createElement("span",{className:"id"},t.id),r.a.createElement(Q,null))};var ve=Object(H.a)(ge),fe=function(e){function t(){return Object(u.a)(this,t),Object(p.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"home"},"See sidebar to get started"),r.a.createElement(ie,{lines:this.props.log}))}}]),t}(n.Component),be=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(p.a)(this,Object(m.a)(t).call(this,e))).renderNotFound=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"path";return r.a.createElement("div",{className:"not-found"},"Oops! I'm afraid that ",e," couldn't be found.")},a.state={instances:{},clients:{},plugins:{},sidebarOpen:!1},a.logLines=[],a.logMap={},window.maubot=Object(D.a)(Object(D.a)(a)),a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.location!==e.location&&this.setState({sidebarOpen:!1})}},{key:"componentWillMount",value:function(){var e=Object(l.a)(o.a.mark(function e(){var t,a,n,r,s,i,c,l,u,d,p,m,h,g,v,f,b,E,y,w,O,N,k,j,x,S,C=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([_.getInstances(),_.getClients(),_.getPlugins()]);case 2:for(t=e.sent,a=Object(F.a)(t,3),n=a[0],r=a[1],s=a[2],i={},c=!0,l=!1,u=void 0,e.prev=11,d=n[Symbol.iterator]();!(c=(p=d.next()).done);c=!0)m=p.value,i[m.id]=m;e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),l=!0,u=e.t0;case 19:e.prev=19,e.prev=20,c||null==d.return||d.return();case 22:if(e.prev=22,!l){e.next=25;break}throw u;case 25:return e.finish(22);case 26:return e.finish(19);case 27:for(h={},g=!0,v=!1,f=void 0,e.prev=31,b=r[Symbol.iterator]();!(g=(E=b.next()).done);g=!0)y=E.value,h[y.id]=y;e.next=39;break;case 35:e.prev=35,e.t1=e.catch(31),v=!0,f=e.t1;case 39:e.prev=39,e.prev=40,g||null==b.return||b.return();case 42:if(e.prev=42,!v){e.next=45;break}throw f;case 45:return e.finish(42);case 46:return e.finish(39);case 47:for(w={},O=!0,N=!1,k=void 0,e.prev=51,j=s[Symbol.iterator]();!(O=(x=j.next()).done);O=!0)S=x.value,w[S.id]=S;e.next=59;break;case 55:e.prev=55,e.t2=e.catch(51),N=!0,k=e.t2;case 59:e.prev=59,e.prev=60,O||null==j.return||j.return();case 62:if(e.prev=62,!N){e.next=65;break}throw k;case 65:return e.finish(62);case 66:return e.finish(59);case 67:return this.setState({instances:i,clients:h,plugins:w}),e.next=70,_.openLogSocket();case 70:e.sent.onLog=function(e){C.logLines.push(e),(C.logMap[e.name]||(C.logMap[e.name]=[])).push(e),C.setState({})};case 72:case"end":return e.stop()}},e,this,[[11,15,19,27],[20,,22,26],[31,35,39,47],[40,,42,46],[51,55,59,67],[60,,62,66]])}));return function(){return e.apply(this,arguments)}}()},{key:"renderList",value:function(e,t){return this.state[e]&&Object.values(this.state[e]).map(function(e){return r.a.createElement(t,{key:e.id,entry:e})})}},{key:"delete",value:function(e,t){var a=Object.assign({},this.state[e]);delete a[t],this.setState(Object(M.a)({},e,a))}},{key:"add",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=Object.assign({},this.state[e]);a&&a!==t.id&&delete n[a],n[t.id]=t,this.setState(Object(M.a)({},e,n))}},{key:"getLog",value:function(e,t){return"clients"===e?this.logMap["maubot.client.".concat(t)]:"instances"===e?this.logMap["maubot.plugin.".concat(t)]:"plugins"===e?this.logMap["maubot.loader.zip"]:void 0}},{key:"renderView",value:function(e,t,a){var n=this,s=this.state[e][a];return s?(console.log("maubot.".concat(e.slice(0,-1),".").concat(a)),r.a.createElement(t,{entry:s,onDelete:function(){return n.delete(e,a)},onChange:function(t){return n.add(e,t,a)},ctx:this.state,log:this.getLog(e,a)||[]})):this.renderNotFound(e.slice(0,-1))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"dashboard ".concat(this.state.sidebarOpen?"sidebar-open":"")},r.a.createElement(V.a,{to:"/",className:"title"},r.a.createElement("img",{src:"/favicon.png",alt:""}),"Maubot Manager"),r.a.createElement("div",{className:"user"},r.a.createElement("span",null,localStorage.username)),r.a.createElement("nav",{className:"sidebar"},r.a.createElement("div",{className:"instances list"},r.a.createElement("div",{className:"title"},r.a.createElement("h2",null,"Instances"),r.a.createElement(V.a,{to:"/new/instance"},r.a.createElement(B,null))),this.renderList("instances",le.ListEntry)),r.a.createElement("div",{className:"clients list"},r.a.createElement("div",{className:"title"},r.a.createElement("h2",null,"Clients"),r.a.createElement(V.a,{to:"/new/client"},r.a.createElement(B,null))),this.renderList("clients",he.ListEntry)),r.a.createElement("div",{className:"plugins list"},r.a.createElement("div",{className:"title"},r.a.createElement("h2",null,"Plugins"),r.a.createElement(V.a,{to:"/new/plugin"},r.a.createElement(B,null))),this.renderList("plugins",ve.ListEntry))),r.a.createElement("div",{className:"topbar"},r.a.createElement("div",{className:"hamburger ".concat(this.state.sidebarOpen?"active":""),onClick:function(t){return e.setState({sidebarOpen:!e.state.sidebarOpen})}},r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null))),r.a.createElement("main",{className:"view"},r.a.createElement(v.a,null,r.a.createElement(b.a,{path:"/",exact:!0,render:function(){return r.a.createElement(fe,{log:e.logLines})}}),r.a.createElement(b.a,{path:"/new/instance",render:function(){return r.a.createElement(le,{onChange:function(t){return e.add("instances",t)},ctx:e.state})}}),r.a.createElement(b.a,{path:"/new/client",render:function(){return r.a.createElement(he,{onChange:function(t){return e.add("clients",t)}})}}),r.a.createElement(b.a,{path:"/new/plugin",render:function(){return r.a.createElement(ve,{onChange:function(t){return e.add("plugins",t)}})}}),r.a.createElement(b.a,{path:"/instance/:id",render:function(t){var a=t.match;return e.renderView("instances",le,a.params.id)}}),r.a.createElement(b.a,{path:"/client/:id",render:function(t){var a=t.match;return e.renderView("clients",he,a.params.id)}}),r.a.createElement(b.a,{path:"/plugin/:id",render:function(t){var a=t.match;return e.renderView("plugins",ve,a.params.id)}}),r.a.createElement(b.a,{render:function(){return e.renderNotFound()}}))))}}]),t}(n.Component),Ee=Object(H.a)(be),ye=function(e){function t(e,a){var n;return Object(u.a)(this,t),(n=Object(p.a)(this,Object(m.a)(t).call(this,e,a))).inputChanged=function(e){return n.setState(Object(M.a)({},e.target.name,e.target.value))},n.login=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({loading:!0}),e.next=3,_.login(n.state.username,n.state.password);case 3:if(!(t=e.sent).token){e.next=9;break}return e.next=7,n.props.onLogin(t.token);case 7:e.next=10;break;case 9:t.error?n.setState({error:t.error,loading:!1}):(n.setState({error:"Unknown error",loading:!1}),console.log("Unknown error:",t));case 10:case"end":return e.stop()}},e,this)})),n.state={username:"",password:"",loading:!1,error:""},n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"login-wrapper"},r.a.createElement("div",{className:"login ".concat(this.state.error&&"errored")},r.a.createElement("h1",null,"Maubot Manager"),r.a.createElement("input",{type:"text",placeholder:"Username",value:this.state.username,name:"username",onChange:this.inputChanged}),r.a.createElement("input",{type:"password",placeholder:"Password",value:this.state.password,name:"password",onChange:this.inputChanged}),r.a.createElement("button",{onClick:this.login},this.state.loading?r.a.createElement(w,null):"Log in"),this.state.error&&r.a.createElement("div",{className:"error"},this.state.error)))}}]),t}(n.Component),we=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(p.a)(this,Object(m.a)(t).call(this,e))).login=function(){var e=Object(l.a)(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.accessToken=t,e.next=3,a.ping();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.state={pinged:!1,authed:!1},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){var e=Object(l.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!localStorage.accessToken){e.next=3;break}return e.next=3,this.ping();case 3:this.setState({pinged:!0});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"ping",value:function(){var e=Object(l.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.ping();case 3:(t=e.sent)?(localStorage.username=t,this.setState({authed:!0})):delete localStorage.accessToken,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.pinged?r.a.createElement(g.a,null,r.a.createElement("div",{className:"maubot-wrapper ".concat(this.state.authed?"authenticated":"")},r.a.createElement(v.a,null,r.a.createElement(y,{path:"/login",render:function(){return r.a.createElement(ye,{onLogin:e.login})},authed:!this.state.authed,to:"/"}),r.a.createElement(y,{path:"/",component:Ee,authed:this.state.authed})))):r.a.createElement(w,{className:"maubot-loading"})}}]),t}(n.Component);i.a.render(r.a.createElement(we,null),document.getElementById("root"))}},[[44,2,1]]]);
//# sourceMappingURL=main.9cdf7796.chunk.js.map