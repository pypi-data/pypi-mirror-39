

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Connecting mosaik and Odysseus &mdash; mosaik 2.5.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="mosaik 2.5.1 documentation" href="../index.html"/>
        <link rel="up" title="Tutorials" href="index.html"/>
        <link rel="next" title="Using Odysseus to process, visualize and store simulation data" href="odysseus2.html"/>
        <link rel="prev" title="Cyclic data-flow" href="cyclicdf.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>
</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> mosaik
          

          
          </a>

          
            
            
              <div class="version">
                2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ecosystem/index.html">Modular Design</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="examplesim.html">Integrating a simulation model into the mosaik ecosystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo1.html">Creating and running simple simulation scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="examplectrl.html">Adding a control mechanism to a scenario</a></li>
<li class="toctree-l2"><a class="reference internal" href="demo2.html">Integrating a control mechanism</a></li>
<li class="toctree-l2"><a class="reference internal" href="cyclicdf.html">Cyclic data-flow</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Connecting mosaik and Odysseus</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#connecting-via-mosaik-protocol-handler">Connecting via mosaik protocol handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connecting-via-zeromq">Connecting via ZeroMQ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="odysseus2.html">Using Odysseus to process, visualize and store simulation data</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_api-java.html">Integrating a Model in Java</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mosaik-api/index.html">The mosaik API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario-definition.html">Scenario definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simmanager.html">The simulator manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler.html">Scheduling and simulation execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">Developer&#8217;s Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About mosaik</a></li>
<li class="toctree-l1"><a class="reference internal" href="../privacy.html">Privacy Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../legals.html">Legals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datenschutz.html">Datenschutz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../impressum.html">Impressum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">mosaik</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
        <li><a href="index.html">Tutorials</a> &raquo;</li>
      
    <li>Connecting mosaik and Odysseus</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="../_sources/tutorials/odysseus.txt" rel="nofollow"> View page source</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="connecting-mosaik-and-odysseus">
<h1>Connecting mosaik and Odysseus<a class="headerlink" href="#connecting-mosaik-and-odysseus" title="Permalink to this headline">¶</a></h1>
<p>In this first part of the tutorial we cover the two ways to connect mosaik and
<a class="reference internal" href="../ecosystem/odysseus.html"><span class="doc">Odysseus</span></a>, the <a class="reference internal" href="odysseus2.html"><span class="doc">second part</span></a> is about how
to use Odysseus to process, visualize and store simulation data.</p>
<p>You can choose between two different solutions to connect mosaik and Odysseus.
Both have their advantages and disadvantages and therefore, the right choice depends on your use case.
We recommend to use the SimAPI version for beginners.</p>
<p>No matter which connection we use, we first have to
<a class="reference external" href="http://odysseus.informatik.uni-oldenburg.de/index.php?id=76&amp;L=2">download</a> Odysseus Server and Studio Client.
For the first start of Odysseus Studio the default user &#8220;System&#8221; and password &#8220;manager&#8221; have to be used,
the tenant can be left empty.</p>
<div class="section" id="connecting-via-mosaik-protocol-handler">
<span id="mosaik-protocol-handler"></span><h2>Connecting via mosaik protocol handler<a class="headerlink" href="#connecting-via-mosaik-protocol-handler" title="Permalink to this headline">¶</a></h2>
<p>The easiest way to connect to mosaik is to use the mosaik protocol handler in
Odysseus, which is available as installable feature in Odysseus Studio. It uses
the mosaik API through remote procedure calls (RPC) and offers a close coupling
of mosaik and Odysseus. With this, a blocked simulation in mosaik or a blocked
processing in Odysseus will block the other system as well. If this is a problem
in your use case, you should look in the section <a class="reference internal" href="#zero-mq"><span class="std std-ref">Connecting via ZeroMQ</span></a>.</p>
<p>First we have to install the following <a class="reference external" href="http://wiki.odysseus.informatik.uni-oldenburg.de/display/ODYSSEUS/How+to+install+new+features">features</a>
in odysseus:</p>
<ul class="simple">
<li>wrapper / mosaik</li>
<li>server / key value processsing</li>
</ul>
<p>After installing the features we create a new Odysseus project and in the
project a new Odysseus script file (more information on Odysseus projects and script files can be found in this
<a class="reference external" href="http://wiki.odysseus.informatik.uni-oldenburg.de/display/ODYSSEUS/Simple+Query+Processing">tutorial</a>).
To use mosaik as source we can
use the mosaik operator which contains a standard configuration of mandatory parameters.
The script-code in the Odysseus query language <a class="reference external" href="http://wiki.odysseus.informatik.uni-oldenburg.de/pages/viewpage.action?pageId=4587829">PQL</a>
looks like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#PARSER PQL</span>
<span class="c1">#METADATA TimeInterval</span>
<span class="c1">#QUERY</span>
<span class="n">mosaikCon</span> <span class="p">:</span><span class="o">=</span> <span class="n">MOSAIK</span><span class="p">({</span><span class="n">SOURCE</span> <span class="o">=</span> <span class="s1">&#39;mosaik&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simapi&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>This is for the standard configuration. If you want to change something, for example
to use another port, you need a more detailed configuration:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#PARSER PQL</span>
<span class="c1">#METADATA TimeInterval</span>
<span class="c1">#QUERY</span>
<span class="n">mosaikCon1</span> <span class="p">:</span><span class="o">=</span> <span class="n">ACCESS</span><span class="p">({</span><span class="n">TRANSPORT</span> <span class="o">=</span> <span class="s1">&#39;TCPServer&#39;</span><span class="p">,</span>
                    <span class="n">PROTOCOL</span> <span class="o">=</span> <span class="s1">&#39;mosaik&#39;</span><span class="p">,</span>
                    <span class="n">SOURCE</span> <span class="o">=</span> <span class="s1">&#39;mosaik&#39;</span><span class="p">,</span>
                    <span class="n">DATAHANDLER</span> <span class="o">=</span> <span class="s1">&#39;KeyValueObject&#39;</span><span class="p">,</span>
                    <span class="n">WRAPPER</span> <span class="o">=</span> <span class="s1">&#39;GenericPush&#39;</span><span class="p">,</span>
                    <span class="n">OPTIONS</span> <span class="o">=</span> <span class="p">[</span>
                      <span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="s1">&#39;5555&#39;</span><span class="p">],</span>
                      <span class="p">[</span><span class="s1">&#39;mosaikPort&#39;</span><span class="p">,</span> <span class="s1">&#39;5554&#39;</span><span class="p">],</span>
                      <span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">,</span> <span class="s1">&#39;LITTLE_ENDIAN&#39;</span><span class="p">]</span>
                    <span class="p">]})</span>
</pre></div>
</div>
<p>As we can see the protocol &#8216;mosaik&#8217; is chosen. When the query is started, the mosaik
protocol handler in Odysseus opens a TCP server for receiving data from mosaik.</p>
<p>Before we can receive data, we have to adapt our mosaik <a class="reference internal" href="../scenario-definition.html"><span class="doc">scenario</span></a>.
Here we take the mosaik-demo as an example. The Odysseus simulator is treated
just like any other component in mosaik. It has to be added to the <code class="docutils literal"><span class="pre">SIM_CONFIG</span></code> parameter.
For the connection to the simulator the <code class="docutils literal"><span class="pre">connect</span></code> command is used and the IP
address and port of Odysseus have to be specified:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sim_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Odysseus&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;connect&#39;</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1:5554&#39;</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>After that, we have to initialize the simulator and connect it to all components whose data we want to revceive in Odysseus.
For the mosaik-demo, we have to add the following lines of code to the scenario definition:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="c1"># Start simulators</span>
    <span class="n">odysseusModel</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s1">&#39;Odysseus&#39;</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">60</span><span class="o">*</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># Instantiate models</span>
    <span class="n">odysseus</span> <span class="o">=</span> <span class="n">odysseusModel</span><span class="o">.</span><span class="n">Odysseus</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ody</span> <span class="o">=</span> <span class="n">odysseus</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Connect entities</span>
    <span class="n">connect_many_to_one</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">ody</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">)</span>
    <span class="n">connect_many_to_one</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">houses</span><span class="p">,</span> <span class="n">ody</span><span class="p">,</span> <span class="s1">&#39;P_out&#39;</span><span class="p">)</span>
    <span class="n">connect_many_to_one</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">pvs</span><span class="p">,</span> <span class="n">ody</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we have set up everything to receive mosaiks data in Odysseus.
To begin transfering data we have to start first the query in Odysseus and then the simulation in mosaik.</p>
<p>For more information on how to use Odysseus visit <a class="reference internal" href="odysseus2.html"><span class="doc">part two</span></a>.</p>
</div>
<div class="section" id="connecting-via-zeromq">
<span id="zero-mq"></span><h2>Connecting via ZeroMQ<a class="headerlink" href="#connecting-via-zeromq" title="Permalink to this headline">¶</a></h2>
<p>In contrast to the close coupling via mosaik protocol handler the coupling via
<a class="reference external" href="https://en.wikipedia.org/wiki/%C3%98MQ">ZeroMQ</a> is more loose.
Mosaik sends all data as data stream with ZeroMQ and Odysseus can even be closed
and restarted during the simulation without affecting mosaik.
This behaviour holds the risk of loosing data so it should only be used if this
doesn&#8217;t cause problems.</p>
<p>First we have to install the following <a class="reference external" href="http://wiki.odysseus.informatik.uni-oldenburg.de/display/ODYSSEUS/How+to+install+new+features">features</a>
for Odysseus:</p>
<ul class="simple">
<li>wrapper / Zero MQ</li>
<li>server / key value processsing</li>
<li>wrapper / mosaik (only if you want to use the mosaik operator)</li>
</ul>
<p>After installing the feature we create a new Odysseus project
and in the project a new Odysseus script file.
The messages sent by mosaik are formatted in JSON format and sent via ZeroMQ.
So we have to choose the corresponding ZeroMQ transport handler and JSON protocol handler:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#PARSER PQL</span>
<span class="c1">#METADATA TimeInterval</span>
<span class="c1">#QUERY</span>
<span class="n">mosaikCon3</span> <span class="p">:</span><span class="o">=</span> <span class="n">ACCESS</span><span class="p">({</span><span class="n">TRANSPORT</span> <span class="o">=</span> <span class="s1">&#39;ZeroMQ&#39;</span><span class="p">,</span>
                    <span class="n">PROTOCOL</span> <span class="o">=</span> <span class="s1">&#39;JSON&#39;</span><span class="p">,</span>
                    <span class="n">SOURCE</span> <span class="o">=</span> <span class="s1">&#39;mosaik&#39;</span><span class="p">,</span>
                    <span class="n">DATAHANDLER</span> <span class="o">=</span> <span class="s1">&#39;KeyValueObject&#39;</span><span class="p">,</span>
                    <span class="n">WRAPPER</span> <span class="o">=</span> <span class="s1">&#39;GenericPush&#39;</span><span class="p">,</span>
                    <span class="n">OPTIONS</span> <span class="o">=</span> <span class="p">[</span>
                      <span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">],</span>
                      <span class="p">[</span><span class="s1">&#39;readport&#39;</span><span class="p">,</span> <span class="s1">&#39;5558&#39;</span><span class="p">],</span>
                      <span class="p">[</span><span class="s1">&#39;writeport&#39;</span><span class="p">,</span> <span class="s1">&#39;5559&#39;</span><span class="p">],</span>
                      <span class="p">[</span><span class="s1">&#39;byteorder&#39;</span><span class="p">,</span> <span class="s1">&#39;LITTLE_ENDIAN&#39;</span><span class="p">]</span>
                    <span class="p">]})</span>
</pre></div>
</div>
<p>If you use the standard configurtion you can use the short version (feature &#8220;wrapper / mosaik&#8221; has to be installed):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#PARSER PQL</span>
<span class="c1">#METADATA TimeInterval</span>
<span class="c1">#QUERY</span>
<span class="n">mosaikCon2</span> <span class="p">:</span><span class="o">=</span> <span class="n">MOSAIK</span><span class="p">({</span><span class="n">SOURCE</span> <span class="o">=</span> <span class="s1">&#39;mosaik&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;zeromq&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>After setting up Odysseus we have to install the mosaik-zmq adapter in our mosaik virtualenv.
It is available on <a class="reference external" href="https://bitbucket.org/mosaik/mosaik-zmq">bitbucket</a> and PyPI.
To install it we have to activate our mosaik virtualenv and execute (if there are errors during installation have a look at the readme on
<a class="reference external" href="https://bitbucket.org/mosaik/mosaik-zmq">bitbucket</a>):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">mosaik</span><span class="o">-</span><span class="n">zmq</span>
</pre></div>
</div>
<p>The mosaik-zmq adapter is treated in mosaik like any other component of the simulation.
If we use the mosaik demo for an example we have to add the new simulator to
the <code class="docutils literal"><span class="pre">SIM_CONFIG</span></code> parameter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sim_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ZMQ&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;cmd&#39;</span><span class="p">:</span> <span class="s1">&#39;mosaik-zmq </span><span class="si">%(addr)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="p">},</span>
</pre></div>
</div>
<p>Also we have to initialize the ZeroMQ simulator and connect it to other components:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="c1"># Start simulators</span>
    <span class="n">zmqModel</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s1">&#39;ZMQ&#39;</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">END</span><span class="p">)</span>

    <span class="c1"># Instantiate models</span>
    <span class="n">zmq</span> <span class="o">=</span> <span class="n">zmqModel</span><span class="o">.</span><span class="n">Socket</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;tcp://*:&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5558</span><span class="p">,</span> <span class="n">socket_type</span><span class="o">=</span><span class="s1">&#39;PUB&#39;</span><span class="p">)</span>

    <span class="c1"># Connect entities</span>
    <span class="n">connect_many_to_one</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">zmq</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">)</span>
    <span class="n">connect_many_to_one</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">houses</span><span class="p">,</span> <span class="n">zmq</span><span class="p">,</span> <span class="s1">&#39;P_out&#39;</span><span class="p">)</span>
    <span class="n">connect_many_to_one</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">pvs</span><span class="p">,</span> <span class="n">zmq</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information on how to use Odysseus visit <a class="reference internal" href="odysseus2.html"><span class="doc">part two</span></a>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="odysseus2.html" class="btn btn-neutral float-right" title="Using Odysseus to process, visualize and store simulation data" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cyclicdf.html" class="btn btn-neutral" title="Cyclic data-flow" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2018 OFFIS.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.5.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   
  <!-- Piwik Image Tracker-->
  <img src="https://mosaik.offis.de/analytics/piwik.php?idsite=4&rec=1" style="border:0" alt="" />
  <!-- End Piwik -->
</body>
</html>