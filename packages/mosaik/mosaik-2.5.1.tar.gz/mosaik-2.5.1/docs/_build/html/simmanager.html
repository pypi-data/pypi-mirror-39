

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The simulator manager &mdash; mosaik 2.5.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="mosaik 2.5.1 documentation" href="index.html"/>
        <link rel="next" title="Scheduling and simulation execution" href="scheduler.html"/>
        <link rel="prev" title="Scenario definition" href="scenario-definition.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>
</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> mosaik
          

          
          </a>

          
            
            
              <div class="version">
                2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="ecosystem/index.html">Modular Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="mosaik-api/index.html">The mosaik API</a></li>
<li class="toctree-l1"><a class="reference internal" href="scenario-definition.html">Scenario definition</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The simulator manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduler.html">Scheduling and simulation execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev/index.html">Developer&#8217;s Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="about/index.html">About mosaik</a></li>
<li class="toctree-l1"><a class="reference internal" href="privacy.html">Privacy Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="legals.html">Legals</a></li>
<li class="toctree-l1"><a class="reference internal" href="datenschutz.html">Datenschutz</a></li>
<li class="toctree-l1"><a class="reference internal" href="impressum.html">Impressum</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">mosaik</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>The simulator manager</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="_sources/simmanager.txt" rel="nofollow"> View page source</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-simulator-manager">
<h1>The simulator manager<a class="headerlink" href="#the-simulator-manager" title="Permalink to this headline">¶</a></h1>
<p>The simulator manager (or just <em>sim manager</em>) is responsible for starting and
handling the external simulator processes involved in a simulation as well as
for the communication with them.</p>
<p>Usually, these simulators will be started as separate sub-processes which will
then connect to mosaik via network sockets. This has two benefits:</p>
<ol class="arabic simple">
<li>Simulators can be written in any language.</li>
<li>Simulation steps can be performed in parallel, if two processes don&#8217;t depend
on each others data.</li>
</ol>
<p>Simulators written in Python 3 can, for performance reasons, be imported and
executed like normal Python modules. This way, all Sim API calls will be plain
functions calls without the overhead of network communication and message
(de)serialization. However, since Python only runs in one thread at a time,
this will also prevent parallel execution of simulators.</p>
<p>When a (Python 3) simulator is computationally inexpensive, running it
in-process may give you good results. If it performs a lot of expensive
computations, it may be better to start separate processes which can then do
these computations in parallel. In practice, you should try and profile both
ways in order to get the maximum performance out of it.</p>
<p>Sometimes, both ways won&#8217;t work because you simply cannot start the simulator
process by yourself. This might be the reason for hardware-in-the-loop or if
a simulator needs to run on a separate machine. In these cases, you can simply
let mosaik connect to a running instance of such a simulator.</p>
<p>Internally, all three kinds of simulator processes (in-process with mosaik,
started by mosaik, connected to by mosaik) are represented by <em>SimProxy</em>
objects so that they all look the same to the other components of mosaik:</p>
<a class="reference internal image-reference" href="_images/simmanager.svg"><div align="center" class="align-center"><img alt="The sim manager can import Python simulators, can start simulators as sub-processes and can connect to running instances of a simulator." src="_images/simmanager.svg" width="530" /></div>
</a>
<p>The sim manager gets its configuration via the <a class="reference internal" href="api_reference/mosaik.scenario.html#mosaik.scenario.World" title="mosaik.scenario.World"><code class="xref py py-class docutils literal"><span class="pre">World</span></code></a>’s <em>sim_config</em> argument. The <em>sim_config</em> is a dictionary containing simulator
names and description of how to start them:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">mosaik</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim_config</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;SimA&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s1">&#39;python&#39;</span><span class="p">:</span> <span class="s1">&#39;package.module:SimClass&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="s1">&#39;SimB&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s1">&#39;cmd&#39;</span><span class="p">:</span> <span class="s1">&#39;java -jar simB.jar </span><span class="si">%(addr)s</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s1">&#39;cwd&#39;</span><span class="p">:</span> <span class="s1">&#39;simB/dist/&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="s1">&#39;SimC&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s1">&#39;connect&#39;</span><span class="p">:</span> <span class="s1">&#39;localhost:5678&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span><span class="p">}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">world</span> <span class="o">=</span> <span class="n">mosaik</span><span class="o">.</span><span class="n">World</span><span class="p">(</span><span class="n">sim_config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">world</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
<p>In the example above, we declare three different simulators. You can freely
choose a name for a simulator. Its configuration should either contain
a <em>python</em>, <em>cmd</em> or <em>connect</em> entry:</p>
<p>Since mosaik 2.3.0 it is possible to pass environment variables to
sub-processes. Using the key <em>env</em> in sim_config allows you to set new
environment variables. That could look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">mosaik</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim_config</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;SimA&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="s1">&#39;python&#39;</span><span class="p">:</span> <span class="s1">&#39;package.module:SimClass&#39;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s1">&#39;env&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>           <span class="s1">&#39;PYTHONPATH&#39;</span><span class="p">:</span> <span class="s1">&#39;src/&#39;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span><span class="p">}</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">world</span> <span class="o">=</span> <span class="n">mosaik</span><span class="o">.</span><span class="n">World</span><span class="p">(</span><span class="n">sim_config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">world</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
<dl class="docutils">
<dt><em>python</em></dt>
<dd>This tells mosaik to run the simulator in process. As a value, you need to
specify the module and class name of the simulator separated by a colon.
In the example, mosaik will <code class="docutils literal"><span class="pre">import</span> <span class="pre">package.module</span></code> and instantiate <code class="docutils literal"><span class="pre">sim</span>
<span class="pre">=</span> <span class="pre">package.module.SimClass()</span></code>. This only works for simulators written in
Python 3.</dd>
<dt><em>cmd</em></dt>
<dd><p class="first">This tells mosaik to execute the specified command <em>cmd</em> in order to start a
new sub-process for the simulator.</p>
<p>You can use the placeholder <code class="docutils literal"><span class="pre">%(python)s</span></code> to use the same Python interpreter
and virtualenv that mosaik currently uses (see <code class="xref py py-attr docutils literal"><span class="pre">sys.executable</span></code>).</p>
<p>In order to create a socket connection to mosaik the simulator needs to know
the address of mosaik&#8217;s server socket. Mosaik will pass this address (in the
form <code class="docutils literal"><span class="pre">host:port</span></code>) as a command line argument, so you need to include the
placeholder <code class="docutils literal"><span class="pre">%(addr)s</span></code> in your command. Mosaik will replace this with the
actual address.</p>
<p>You can optionally specify a current working directory <em>(cwd)</em>. If it is
present, mosaik will change to that directory before executing <em>cmd</em>. Its
default value is <code class="docutils literal"><span class="pre">'.'</span></code>.</p>
<p>In our example, mosaik would execute:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> simB/java
$ java -jar simB.jar localhost:5555
</pre></div>
</div>
<p class="last">in order to start <em>SimB</em>.</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please use for the <em>cwd</em> command and for paths in the <em>cmd</em> call only the UNIX/Linux path notation with         slashes even if you are using windows. Do not use backslashes or double backslashes.</p>
</div>
<dl class="docutils">
<dt><em>connect</em></dt>
<dd>This tells mosaik to establish a network connection to a running simulator
instance. It will simply connect to <code class="docutils literal"><span class="pre">host:port</span></code> – <code class="docutils literal"><span class="pre">localhost:5678</span></code> for
<em>SimC</em></dd>
</dl>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="scheduler.html" class="btn btn-neutral float-right" title="Scheduling and simulation execution" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="scenario-definition.html" class="btn btn-neutral" title="Scenario definition" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2018 OFFIS.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.5.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   
  <!-- Piwik Image Tracker-->
  <img src="https://mosaik.offis.de/analytics/piwik.php?idsite=4&rec=1" style="border:0" alt="" />
  <!-- End Piwik -->
</body>
</html>