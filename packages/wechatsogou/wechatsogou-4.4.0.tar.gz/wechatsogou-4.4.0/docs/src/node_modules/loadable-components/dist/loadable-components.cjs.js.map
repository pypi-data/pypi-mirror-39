{"version":3,"file":"loadable-components.cjs.js","sources":["../src/componentTracker.js","../src/constants.js","../src/loadComponents.js","../src/getState.js","../src/utils/resolveModuleDefault.js","../src/loadable.js","../src/index.js"],"sourcesContent":["let components = {}\n\nexport const track = (component, modules, index = 0) => {\n  let id = modules.join('-')\n  if (index) id += `-${index}`\n  if (components[id]) {\n    return track(component, modules, index + 1)\n  }\n  components[id] = component\n  return id\n}\n\nexport const get = id => components[id]\nexport const getAll = () => ({ ...components })\nexport const reset = () => {\n  components = {}\n}\n","export const LOADABLE_STATE = '__LOADABLE_STATE__'\nexport const LOADABLE = '@@loadable-components/loadable'\n","/* eslint-env browser */\nimport { LOADABLE, LOADABLE_STATE } from './constants'\nimport * as componentTracker from './componentTracker'\n\nfunction loadState(rootState) {\n  if (!rootState.children) return Promise.resolve(null)\n\n  return Promise.all(\n    rootState.children.map(state => {\n      const component = componentTracker.get(state.id)\n\n      if (!component) {\n        console.warn( // eslint-disable-line\n          'loadable-component client modules:',\n          componentTracker.getAll(),\n        )\n        console.warn( // eslint-disable-line\n          'loadable-component server modules:',\n          window[LOADABLE_STATE],\n        )\n\n        return Promise.reject(new Error(`loadable-components: module \"${\n          state.id\n        }\" is not found, client and server modules are not sync. You are probably not using the same resolver on server and client.`))\n      }\n\n      const getLoadable = component[LOADABLE]\n\n      if (typeof getLoadable !== 'function') {\n        return Promise.reject(new Error(`loadable-components: module \"${\n          state.id\n        }\" is not a loadable component, please verify your SSR setup`))\n      }\n\n      return getLoadable()\n        .load()\n        .then(() => loadState(state))\n    }),\n  )\n}\n\nfunction loadComponents() {\n  if (typeof window === 'undefined') {\n    return Promise.reject(new Error('loadable-components: `loadComponents` must ' +\n      'be called client-side: `window` is undefined'))\n  }\n\n  const state = window[LOADABLE_STATE]\n  if (!state) {\n    return Promise.reject(new Error('loadable-components state not found. ' +\n      'You have a problem server-side. ' +\n      'Please verify that you have called `loadableState.getScriptTag()` server-side.'))\n  }\n\n  return loadState(state)\n}\n\nexport default loadComponents\n","/* eslint-env browser */\n/* eslint-disable import/prefer-default-export */\nimport { getAll as getAllComponents } from './componentTracker'\nimport { LOADABLE_STATE } from './constants'\n\nfunction getState() {\n  const componentByIds = getAllComponents()\n  const children = Object.keys(componentByIds).reduce((ids, id) => {\n    const component = componentByIds[id]\n    if (component.loadingPromise) return [...ids, { id: component.componentId }]\n    return ids\n  }, [])\n  return { [LOADABLE_STATE]: { children } }\n}\n\nexport default getState\n","/* eslint-disable no-underscore-dangle */\nconst resolveModuleDefault = module =>\n  module.__esModule ? module.default : module\n\nexport default resolveModuleDefault\n","/* eslint-disable react/sort-comp */\nimport React from 'react'\nimport hoistNonReactStatics from 'hoist-non-react-statics'\nimport { LOADABLE } from './constants'\nimport resolveModuleDefault from './utils/resolveModuleDefault'\nimport * as componentTracker from './componentTracker'\n\nconst EmptyComponent = () => null\n\nfunction loadable(\n  getComponent,\n  {\n    ErrorComponent = EmptyComponent,\n    LoadingComponent = EmptyComponent,\n    render,\n    modules,\n    asyncMode,\n  } = {},\n) {\n  class LoadableComponent extends React.Component {\n    static Component = null\n    static loadingPromise = null\n\n    static load() {\n      if (!LoadableComponent.loadingPromise) {\n        LoadableComponent.loadingPromise = getComponent()\n          .then(module => {\n            const Component = resolveModuleDefault(module)\n            LoadableComponent.Component = Component\n            hoistNonReactStatics(LoadableComponent, Component, {\n              Component: true,\n              loadingPromise: true,\n              load: true,\n              [LOADABLE]: true,\n              componentId: true,\n            })\n            return Component\n          })\n          .catch(error => {\n            LoadableComponent.loadingPromise = null\n            throw error\n          })\n      }\n\n      return LoadableComponent.loadingPromise\n    }\n\n    constructor(props) {\n      super(props)\n      this.state = {\n        Component: LoadableComponent.Component,\n        error: null,\n        loading: !LoadableComponent.Component,\n      }\n      this.mounted = false\n      this.loadingPromise = null\n\n      if (\n        typeof window !== 'undefined' &&\n        this.state.Component === null &&\n        this.loadingPromise === null\n      ) {\n        this.loadingPromise = LoadableComponent.load()\n          .then(Component => {\n            this.safeSetState({ Component, loading: false })\n          })\n          .catch(error => {\n            this.safeSetState({ error, loading: false })\n          })\n      }\n    }\n\n    componentDidMount() {\n      this.mounted = true\n    }\n\n    componentWillUnmount() {\n      this.mounted = false\n    }\n\n    safeSetState(state) {\n      if (!this.mounted) return\n      this.setState(state)\n    }\n\n    render() {\n      const { Component, error } = this.state\n\n      if (typeof render === 'function') {\n        return render({\n          ...this.state,\n          ownProps: this.props,\n        })\n      }\n\n      if (Component !== null) {\n        return <Component {...this.props} />\n      }\n\n      if (error !== null) {\n        return <ErrorComponent error={error} ownProps={this.props} />\n      }\n\n      if (asyncMode) {\n        throw this.loadingPromise\n      }\n\n      return <LoadingComponent {...this.props} />\n    }\n  }\n\n  LoadableComponent[LOADABLE] = () => LoadableComponent\n\n  if (modules) {\n    const id = componentTracker.track(LoadableComponent, modules)\n    LoadableComponent.componentId = id\n  }\n\n  return LoadableComponent\n}\n\nexport default loadable\n","import * as tracker from './componentTracker'\n\nexport { default as loadComponents } from './loadComponents'\nexport { default as getState } from './getState'\nexport { LOADABLE } from './constants'\nexport { default } from './loadable'\nexport const componentTracker = tracker\n"],"names":["components","track","component","modules","index","id","join","get","getAll","reset","LOADABLE_STATE","LOADABLE","loadState","rootState","children","Promise","resolve","all","map","componentTracker","state","warn","window","reject","Error","getLoadable","load","then","loadComponents","getState","componentByIds","getAllComponents","Object","keys","reduce","ids","loadingPromise","componentId","resolveModuleDefault","module","__esModule","default","EmptyComponent","loadable","getComponent","ErrorComponent","LoadingComponent","render","asyncMode","LoadableComponent","Component","catch","error","props","mounted","safeSetState","loading","componentDidMount","componentWillUnmount","setState","React","tracker"],"mappings":"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"}