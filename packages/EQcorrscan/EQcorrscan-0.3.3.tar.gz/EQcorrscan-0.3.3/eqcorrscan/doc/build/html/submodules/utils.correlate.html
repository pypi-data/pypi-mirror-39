

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.5. correlate &mdash; EQcorrscan 0.3.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/EQcorrscan_logo.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="EQcorrscan 0.3.0 documentation" href="../index.html"/>
        <link rel="up" title="5. Utils" href="../utils.html"/>
        <link rel="next" title="5.5.1.1. eqcorrscan.utils.correlate.fftw_multi_normxcorr" href="autogen/eqcorrscan.utils.correlate.fftw_multi_normxcorr.html"/>
        <link rel="prev" title="5.4.1.13. eqcorrscan.utils.clustering.space_time_cluster" href="autogen/eqcorrscan.utils.clustering.space_time_cluster.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> EQcorrscan
          

          
            
            <img src="../_static/EQcorrscan_logo.jpg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">1. Introduction to the EQcorrscan package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">2. EQcorrscan installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates.html">3. What’s new</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">EQcorrscan tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core.html">4. Core</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../utils.html">5. Utils</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="utils.archive_read.html">5.1. archive_read</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.catalog_to_dd.html">5.2. catalog_to_dd</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.catalog_utils.html">5.3. catalog_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.clustering.html">5.4. clustering</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.5. correlate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#classes-functions">5.5.1. Classes &amp; Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.fftw_multi_normxcorr.html">5.5.1.1. eqcorrscan.utils.correlate.fftw_multi_normxcorr</a></li>
<li class="toctree-l4"><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.fftw_normxcorr.html">5.5.1.2. eqcorrscan.utils.correlate.fftw_normxcorr</a></li>
<li class="toctree-l4"><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.numpy_normxcorr.html">5.5.1.3. eqcorrscan.utils.correlate.numpy_normxcorr</a></li>
<li class="toctree-l4"><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.time_multi_normxcorr.html">5.5.1.4. eqcorrscan.utils.correlate.time_multi_normxcorr</a></li>
<li class="toctree-l4"><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.get_array_xcorr.html">5.5.1.5. eqcorrscan.utils.correlate.get_array_xcorr</a></li>
<li class="toctree-l4"><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.get_stream_xcorr.html">5.5.1.6. eqcorrscan.utils.correlate.get_stream_xcorr</a></li>
<li class="toctree-l4"><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.register_array_xcorr.html">5.5.1.7. eqcorrscan.utils.correlate.register_array_xcorr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#selecting-a-correlation-function">5.5.2. Selecting a correlation function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-fast-matched-filter-within-eqcorrscan">5.5.3. Using Fast Matched Filter within EQcorrscan</a></li>
<li class="toctree-l3"><a class="reference internal" href="#switching-which-correlation-function-is-used">5.5.4. Switching which correlation function is used</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notes-on-accuracy">5.5.5. Notes on accuracy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#warning">5.5.6. Warning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="utils.despike.html">5.6. despike</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.findpeaks.html">5.7. findpeaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.mag_calc.html">5.8. mag_calc</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.parameters.html">5.9. parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.picker.html">5.10. picker</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.plotting.html">5.11. plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.pre_processing.html">5.12. pre_processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.sac_util.html">5.13. sac_util</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.seismo_logs.html">5.14. seismo_logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.stacking.html">5.15. stacking</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.synth_seis.html">5.16. synth_seis</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.trigger.html">5.17. trigger</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">EQcorrscan</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../utils.html">5. Utils</a> &raquo;</li>
        
      <li>5.5. correlate</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/submodules/utils.correlate.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-eqcorrscan.utils.correlate">
<span id="correlate"></span><h1>5.5. correlate<a class="headerlink" href="#module-eqcorrscan.utils.correlate" title="Permalink to this headline">¶</a></h1>
<p>Correlation functions for multi-channel cross-correlation of seismic data.</p>
<p>Various routines used mostly for testing, including links to a compiled
routine using FFTW, a Numpy fft routine which uses bottleneck for normalisation
and a compiled time-domain routine. These have varying levels of efficiency,
both in terms of overall speed, and in memory usage.  The time-domain is the
most memory efficient but slowest routine (although fast for small cases of
less than a few hundred correlations), the Numpy routine is fast, but memory
inefficient due to a need to store large double-precision arrays for
normalisation.  The fftw compiled routine is faster and more memory efficient
than the Numpy routine.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">copyright:</th><td class="field-body">EQcorrscan developers.</td>
</tr>
<tr class="field-even field"><th class="field-name">license:</th><td class="field-body">GNU Lesser General Public License, Version 3
(<a class="reference external" href="https://www.gnu.org/copyleft/lesser.html">https://www.gnu.org/copyleft/lesser.html</a>)</td>
</tr>
</tbody>
</table>
<div class="section" id="classes-functions">
<h2>5.5.1. Classes &amp; Functions<a class="headerlink" href="#classes-functions" title="Permalink to this headline">¶</a></h2>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.fftw_multi_normxcorr.html#eqcorrscan.utils.correlate.fftw_multi_normxcorr" title="eqcorrscan.utils.correlate.fftw_multi_normxcorr"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fftw_multi_normxcorr</span></code></a></td>
<td>Use a C loop rather than a Python loop - in some cases this will be fast.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.fftw_normxcorr.html#eqcorrscan.utils.correlate.fftw_normxcorr" title="eqcorrscan.utils.correlate.fftw_normxcorr"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fftw_normxcorr</span></code></a></td>
<td>Normalised cross-correlation using the fftw library.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.numpy_normxcorr.html#eqcorrscan.utils.correlate.numpy_normxcorr" title="eqcorrscan.utils.correlate.numpy_normxcorr"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy_normxcorr</span></code></a></td>
<td>Compute the normalized cross-correlation using numpy and bottleneck.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.time_multi_normxcorr.html#eqcorrscan.utils.correlate.time_multi_normxcorr" title="eqcorrscan.utils.correlate.time_multi_normxcorr"><code class="xref py py-obj docutils literal notranslate"><span class="pre">time_multi_normxcorr</span></code></a></td>
<td>Compute cross-correlations in the time-domain using C routine.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.get_array_xcorr.html#eqcorrscan.utils.correlate.get_array_xcorr" title="eqcorrscan.utils.correlate.get_array_xcorr"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_array_xcorr</span></code></a></td>
<td>Get an normalized cross correlation function that takes arrays as inputs.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.get_stream_xcorr.html#eqcorrscan.utils.correlate.get_stream_xcorr" title="eqcorrscan.utils.correlate.get_stream_xcorr"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_stream_xcorr</span></code></a></td>
<td>Return a function for performing normalized cross correlation on lists of streams.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.register_array_xcorr.html#eqcorrscan.utils.correlate.register_array_xcorr" title="eqcorrscan.utils.correlate.register_array_xcorr"><code class="xref py py-obj docutils literal notranslate"><span class="pre">register_array_xcorr</span></code></a></td>
<td>Decorator for registering correlation functions.</td>
</tr>
</tbody>
</table>
</div>
<p>All functions within this module (and therefore all correlation functions used
in EQcorrscan) are normalised cross-correlations, which follow the definition
that Matlab uses for <a href="https://au.mathworks.com/help/images/ref/normxcorr2.html?s_tid=gn_loc_drop" target="_blank">normxcorr2</a>.</p>
<dl class="docutils">
<dt>In the time-domain this is as follows</dt>
<dd><div class="first last math notranslate">
\[c(t) = \frac{\sum_{y}(a_{y} - \overline{a})(b_{t+y} - \overline{b_t})}{\sqrt{\sum_{y}(a_{y} - \overline{a})(a_{y} - \overline{a})\sum_{y}(b_{t+y} - \overline{b_t})(b_{t+y} - \overline{b_t})}}\]</div>
</dd>
</dl>
<p>where <span class="math notranslate">\(c(t)\)</span> is the normalised cross-correlation at at time <span class="math notranslate">\(t\)</span>,
<span class="math notranslate">\(a\)</span> is the template window which has length <span class="math notranslate">\(y\)</span>, <span class="math notranslate">\(b\)</span> is the
continuous data, and <span class="math notranslate">\(\overline{a}\)</span> is the mean of the template and
<span class="math notranslate">\(\overline{b_t}\)</span> is the local mean of the continuous data.</p>
<p>In practice the correlations only remove the mean of the template once, but we do
remove the mean from the continuous data at every time-step.  Without doing this
(just removing the global mean), correlations are affected by jumps in average
amplitude, which is most noticeable during aftershock sequences, or when using
short templates.</p>
<p>In the frequency domain (functions <a class="reference internal" href="autogen/eqcorrscan.utils.correlate.numpy_normxcorr.html#eqcorrscan.utils.correlate.numpy_normxcorr" title="eqcorrscan.utils.correlate.numpy_normxcorr"><code class="xref py py-func docutils literal notranslate"><span class="pre">eqcorrscan.utils.correlate.numpy_normxcorr()</span></code></a>,
<a class="reference internal" href="autogen/eqcorrscan.utils.correlate.fftw_normxcorr.html#eqcorrscan.utils.correlate.fftw_normxcorr" title="eqcorrscan.utils.correlate.fftw_normxcorr"><code class="xref py py-func docutils literal notranslate"><span class="pre">eqcorrscan.utils.correlate.fftw_normxcorr()</span></code></a>, <a class="reference internal" href="autogen/eqcorrscan.utils.correlate.fftw_multi_normxcorr.html#eqcorrscan.utils.correlate.fftw_multi_normxcorr" title="eqcorrscan.utils.correlate.fftw_multi_normxcorr"><code class="xref py py-func docutils literal notranslate"><span class="pre">fftw_multi_normxcorr()</span></code></a>),
correlations are computed using an equivalent method.  All methods are tested
against one-another to check for internal consistency, and checked against results
computed using Matlab’s <a href="https://au.mathworks.com/help/images/ref/normxcorr2.html?s_tid=gn_loc_drop" target="_blank">normxcorr2</a> function. These routines also give the same
(within 0.00001) of openCV cross-correlations.</p>
<div class="section" id="selecting-a-correlation-function">
<h2>5.5.2. Selecting a correlation function<a class="headerlink" href="#selecting-a-correlation-function" title="Permalink to this headline">¶</a></h2>
<p>EQcorrscan strives to use sensible default algorithms for calculating
correlation values, however, you may want to change how correlations are
caclulated to be more advantageous to your specific needs.</p>
<p>There are currently 3 different correlations functions currently included in EQcorrscan:</p>
<blockquote>
<div><ol class="arabic simple">
<li><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.numpy_normxcorr.html#eqcorrscan.utils.correlate.numpy_normxcorr" title="eqcorrscan.utils.correlate.numpy_normxcorr"><code class="xref py py-func docutils literal notranslate"><span class="pre">eqcorrscan.utils.correlate.numpy_normxcorr()</span></code></a> known as “numpy”</li>
<li><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.time_multi_normxcorr.html#eqcorrscan.utils.correlate.time_multi_normxcorr" title="eqcorrscan.utils.correlate.time_multi_normxcorr"><code class="xref py py-func docutils literal notranslate"><span class="pre">eqcorrscan.utils.correlate.time_multi_normxcorr()</span></code></a> known as “time_domain”</li>
<li><a class="reference internal" href="autogen/eqcorrscan.utils.correlate.fftw_normxcorr.html#eqcorrscan.utils.correlate.fftw_normxcorr" title="eqcorrscan.utils.correlate.fftw_normxcorr"><code class="xref py py-func docutils literal notranslate"><span class="pre">eqcorrscan.utils.correlate.fftw_normxcorr()</span></code></a> known as “fftw”</li>
</ol>
</div></blockquote>
<p>Number 3 is the default.</p>
</div>
<div class="section" id="using-fast-matched-filter-within-eqcorrscan">
<h2>5.5.3. Using Fast Matched Filter within EQcorrscan<a class="headerlink" href="#using-fast-matched-filter-within-eqcorrscan" title="Permalink to this headline">¶</a></h2>
<p><a href="https://github.com/beridel/fast_matched_filter" target="_blank">Fast Matched Filter</a> provides fast time-domain correlations for both CPU and GPU
architectures.  For massively multi-threaded environment this runs faster than
the frequency-domain routines mative to EQcorrscan (when more than 40 CPU cores,
or an NVIDIA GPU card is available) with less memory consumption. Documentation
on how to call Fast Matched Filter from within EQcorrscan is provided here:
<a class="reference external" href="utils.correlate.fast_matched_filter.html">fast_matched_filter</a></p>
</div>
<div class="section" id="switching-which-correlation-function-is-used">
<h2>5.5.4. Switching which correlation function is used<a class="headerlink" href="#switching-which-correlation-function-is-used" title="Permalink to this headline">¶</a></h2>
<p>You can switch between correlation functions using the <cite>xcorr_func</cite> parameter
included in:
- <a class="reference internal" href="autogen/eqcorrscan.core.match_filter.match_filter.html#eqcorrscan.core.match_filter.match_filter" title="eqcorrscan.core.match_filter.match_filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">eqcorrscan.core.match_filter.match_filter()</span></code></a>,
- <a class="reference internal" href="core.match_filter.Tribe.html#eqcorrscan.core.match_filter.Tribe.detect" title="eqcorrscan.core.match_filter.Tribe.detect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">eqcorrscan.core.match_filter.Tribe.detect()</span></code></a>,
- <a class="reference internal" href="core.match_filter.Template.html#eqcorrscan.core.match_filter.Template.detect" title="eqcorrscan.core.match_filter.Template.detect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">eqcorrscan.core.match_filter.Template.detect()</span></code></a></p>
<p>by:</p>
<ol class="arabic simple">
<li>passing a string (eg “numpy”, “time_domain”, or “fftw”) or;</li>
<li>passing a function</li>
</ol>
<p>for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">obspy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">eqcorrscan.utils.correlate</span> <span class="kn">import</span> <span class="n">numpy_normxcorr</span><span class="p">,</span> <span class="n">set_xcorr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">eqcorrscan.core.match_filter</span> <span class="kn">import</span> <span class="n">match_filter</span>


<span class="gp">&gt;&gt;&gt; </span><span class="c1"># generate some toy templates and stream</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">template</span> <span class="o">=</span> <span class="n">obspy</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stream</span> <span class="o">=</span> <span class="n">obspy</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>  <span class="c1"># iter stream and embed templates</span>
<span class="gp">... </span>    <span class="n">data</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">data</span>
<span class="gp">... </span>    <span class="n">tr</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">6000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span>
<span class="gp">... </span>    <span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span> <span class="mi">100</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># do correlation using numpy rather than fftw</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">detections</span> <span class="o">=</span> <span class="n">match_filter</span><span class="p">([</span><span class="s1">&#39;1&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">template</span><span class="p">],</span> <span class="n">stream</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span>
<span class="gp">... </span>                          <span class="mi">1</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">xcorr_func</span><span class="o">=</span><span class="s1">&#39;numpy&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># do correlation using a custom function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">custom_normxcorr</span><span class="p">(</span><span class="n">templates</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">pads</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>    <span class="c1"># Just to keep example short call other xcorr function</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;calling custom xcorr function&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">numpy_normxcorr</span><span class="p">(</span><span class="n">templates</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">pads</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">detections</span> <span class="o">=</span> <span class="n">match_filter</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">template</span><span class="p">],</span> <span class="n">stream</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">xcorr_func</span><span class="o">=</span><span class="n">custom_normxcorr</span><span class="p">)</span> 
<span class="go">calling custom xcorr function...</span>
</pre></div>
</div>
<p>You can also use the set_xcorr object (eqcorrscan.utils.correlate.set_xcorr)
to change which correlation function is used. This can be done permanently
or within the scope of a context manager:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># change the default xcorr function for all code in the with block</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">set_xcorr</span><span class="p">(</span><span class="n">custom_normxcorr</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">detections</span> <span class="o">=</span> <span class="n">match_filter</span><span class="p">([</span><span class="s1">&#39;1&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">template</span><span class="p">],</span> <span class="n">stream</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span>
<span class="gp">... </span>                              <span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> 
<span class="go">calling custom xcorr function...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># permanently set the xcorr function (until the python kernel restarts)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">set_xcorr</span><span class="p">(</span><span class="n">custom_normxcorr</span><span class="p">)</span>
<span class="go">default changed to custom_normxcorr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">detections</span> <span class="o">=</span> <span class="n">match_filter</span><span class="p">([</span><span class="s1">&#39;1&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">template</span><span class="p">],</span> <span class="n">stream</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span>
<span class="gp">... </span>                          <span class="mi">1</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> 
<span class="go">calling custom xcorr function...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">set_xcorr</span><span class="o">.</span><span class="n">revert</span><span class="p">()</span>  <span class="c1"># change it back to the previous state</span>
</pre></div>
</div>
</div>
<div class="section" id="notes-on-accuracy">
<h2>5.5.5. Notes on accuracy<a class="headerlink" href="#notes-on-accuracy" title="Permalink to this headline">¶</a></h2>
<p>To cope with floating-point rounding errors, correlations may not be
calculated for data with low variance.  If you see a warning saying:
<em>“Some correlations not computed, are there zeros in the data? If not
consider increasing gain”</em>, check whether your data have zeros, and if not,
but have low, but real amplitudes, multiply your data by some value.</p>
</div>
<div class="section" id="warning">
<h2>5.5.6. Warning<a class="headerlink" href="#warning" title="Permalink to this headline">¶</a></h2>
<p>If data are padded with zeros prior to filtering then correlations may be
incorrectly calculated where there are zeros. You should always pad after
filtering.  If you see warnings saying <em>“Low variance, possible zeros, check
result”</em>, you should check that you have padded correctly and check that
correlations haven’t been calculated when you don’t expect them.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="autogen/eqcorrscan.utils.correlate.fftw_multi_normxcorr.html" class="btn btn-neutral float-right" title="5.5.1.1. eqcorrscan.utils.correlate.fftw_multi_normxcorr" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="autogen/eqcorrscan.utils.clustering.space_time_cluster.html" class="btn btn-neutral" title="5.4.1.13. eqcorrscan.utils.clustering.space_time_cluster" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, 2016: EQcorrscan developers.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>